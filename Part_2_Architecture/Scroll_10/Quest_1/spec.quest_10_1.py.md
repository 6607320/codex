# quest_10_1.py Specification

## 1. Meta Information

- **Domain:** Scripting
- **Complexity:** Medium
- **Language:** Python
- **Frameworks:** cv2, numpy
- **Context:** ../AGENTS.md

## 2. Goal & Purpose (Цель и Назначение)

**Легенда:** Этот файл — демонстрационный рунический Ритуал, который вручную повторяет идею свёртки (Convolution) без магии PyTorch. Он строит простую темную Комнату — тестовый образ 7x7 с вертикальной линией света, выковывает Магический Трафарет (ядро) для вертикальных границ и вручную сканирует комнату чтобы получить Карту Признаков. В конце карта нормализуется и сохраняется как артефакт, доказывая фундаментальную единицу CNN: умножить и сложить, повторяющееся сканирование.

## 3. Interface Contract (Интерфейсный Контракт)

### 3.1. Inputs (Входы)

- **Source:** CLI Args
- **Format:** JSON
- **Schema:**
  - InputData:
    - image: number[][]
    - kernel: number[][]

Описание: входной эфир требует двумер массива пикселей (image) и двумер ядра (kernel) для свёртки. В текущем артефакте квеста изображение и ядро заданы внутри скрипта, однако контракт задаёт форму для внешних вызовов.

### 3.2. Outputs (Выходы)

- **Destination:** File
- **Format:** JSON
- **Success Criteria:** File Created
- **Schema:**
  - OutputResult:
    - originalImagePath: string
    - featureMapPath: string
    - status: "success" | "failure"

Описание: после ритуала артефакты сохраняются во временные файлы: оригинальный облик и Карта Признаков. Контракт фиксирует их пути и общий статус ритуала.

## 4. Implementation Details (The Source DNA / Исходный Код)

### 4.1. Algorithmic Logic (Для исполняемого кода)

1. Инициация эфира: вывести на кристалл сообщение о начале ритуала и создать тестовый образ размером 7x7, заполненный чем-то темным (0) и центральной вертикальной линией света (255).
2. Ковка трафарета: выковать ядро (kernel) как вертикальный Sobel-подобный фильтр: массив 3x3 с коэффициентами [-1, 0, 1] по верхнему ряду, [-2, 0, 2] по среднему, [-1, 0, 1] по нижнему.
3. Ритуал сканирования: разместить окно 3x3 поверх образа и для каждого положения вычислять конволюцию путем поэлементного умножения окна на ядро и суммирования, записывая результат в Карты Признаков (feature_map).
4. Анализ и трансформация: нормализовать карту признаков к диапазону 0–255 для сохранения как изображение, чтобы увидеть яркие участки, где трафарет нашёл совпадения.
5. Завершение и хранение: сохранить нормализованную карту как feature_map.png и сообщить о завершении ритуала, подсказывая как истолковать результат.
6. Визуализация и наставления: выстроить пояснения — карта подсвечивает область соответствующую вертикальной линии в исходном образе.

### 4.2. Declarative Content (Для конфигураций и данных)

- Эфирные данные:
  - Образ: 7x7 черно-белый массив с центральной вертикальной линией (пиксельная карта).
  - Ядро: 3x3 матрица Sobel-подобного фильтра для поиска вертикальных границ.
  - Карта Признаков: матрица меньшего размера (на единицу по каждому измерению) после сканирования, затем нормализуется и сохраняется как изображение.
- Артефакты:
  - оригинальный образ сохраняется как original_line.png
  - карта признаков сохраняется как feature_map.png

## 5. Structural Decomposition (Декомпозиция структуры)

- Инварианты:
  - image: число[][], kernel: число[][], feature_map: число[][]
- Функции и возможные классы:
  - initialize_scene() — создаёт тестовый образ
  - build_kernel() — формирует ядро свёртки
  - apply_convolution() — вручную реализованная свёртка по окну 3x3
  - normalize_and_store() — нормализация карты признаков и сохранение в файл
  - main() — управляет потоком ритуала и выводами
- Данные/артефакты:
  - image, kernel, feature_map
  - original_line.png, feature_map.png

## 6. System Context & Constraints (Системный контекст и Ограничения)

### 6.1. Technical Constraints

- **Performance:** Standard CPU
- **Concurrency:** Sync
- **Dependencies:** OpenCV (cv2), NumPy
- Эфирная работа ограничена небольшим тестовым размером изображения (7x7) и одномерной сканирующей зоной, чтобы держать руническую лампу в рамках локального вычисления.

### 6.2. Prohibited Actions (Negative Constraints)

- Не хранить секреты в открытом виде (использовать окружение при необходимости).
- Не выводить сырые данные в консоль в продакшн-режиме.
- Не выполнять сетевые вызовы в главном цикле ритуала.
- Не оборачивать конфигурационные файлы (.yaml, .json) в скрипты.
- Не менять версии библиотек или путей во время реконструкции.
- Не отклонять контекст от реальных зависимостей и структур, если они не заданы явно.

## 7. Verification & Testing (Верификация)

Герхрин-сценарии:
Feature: Ритуал свёртки quest_10_1
Scenario: Успешное выполнение
Given окружение включает OpenCV и NumPy
When выполняется quest_10_1.py с заданными входами
Then сохранены файлы original_line.png и feature_map.png
And Карта Признаков визуализируется так, что яркость указывает на вертикальную границу исходного образа

Scenario: Ошибка отсутствия зависимостей
Given OpenCV или NumPy недоступны
When выполняется quest_10_1.py
Then процесс завершается с описательным Хаосом и артефакты не создаются

Итоговый артефакт: quest_10_1.py

Примечание архимагу: вся логика and шаги изложены как магические ритуалы, чтобы каждая часть была понятна как элементарная структура: входы — эфир, ядро — трафарет, свёртка — сканирование, карта признаков — световой путь.
