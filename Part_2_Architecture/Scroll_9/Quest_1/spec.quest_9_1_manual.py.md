# quest_9_1_manual.py Specification

## 1. Meta Information

- Domain: ML/NLP
- Complexity: Medium
- Language: Python
- Frameworks: None
- Context: ../AGENTS.md

## 2. Goal & Purpose (Цель и Назначение)

- Context for Creator: Этот модуль демонстрирует ручное вычисление градиентов и обновление параметров линейной модели y = w\*x + b без использования autograd или оптимизатора, чтобы показать, что backpropagation — это выполнение простых математических правил.
- Instruction for AI: Секция задаёт общий замысел и WHY проекта: понять природу градиентов и как в реальности выглядят обновления параметров на примере последовательной настройки рунических струн лука.

Описание: Этот скрипт моделирует последовательную «пристрелку» лука, в ходе которой шагают по цепочке вычислений: прогноз попадания, измерение промаха, вычисление шепотов градиентов и корректировка рунических значений w и b, повторяя цикл заданного числа этапов и выводя итоговую калибровку.

## 3. Interface Contract (Интерфейсный Контракт)

### 3.1. Inputs (Входы)

- Source: CLI Args
- Format: JSON
- Schema:
  - x: number
  - y: number
  - w: number
  - b: number
  - learning_rate: number
  - epochs: number

### 3.2. Outputs (Выходы)

- Destination: STDOUT
- Format: Text
- Success Criteria: Exit Code 0
- Schema:
  - epoch: number
  - yPredicted: number
  - loss: number
  - w: number
  - b: number

## 4. Implementation Details (The Source DNA / Исходный Код)

### 4.1. Algorithmic Logic (Для исполняемого кода)

- Акт 1. Подготовка к Ритуалу:
  - Задаются исходные «эфиры» пары мишень и выстрела: x и y устанавливаются как целевые значения (мишень и центр попадания).
  - Руны Лука: начальные значения w и b устанавливаются в ноль.
  - Скорость Обучения: устанавливается learning_rate (например, 0.01).
  - Сверка целей: печатаются начальные калибровки и цель, чтобы жрецы могли следить за процессом.
- Акт 2. Ритуал «Пристрелки» (15 выстрелов):
  - Шаг 1: Выстрел. Вычисляется попадание y_predicted по формуле: y_predicted = w\*x + b.
  - Шаг 2: Измерение промаха. Промах (loss) вычисляется как квадрат разности между попаданием и центром мишени: loss = (y_predicted - y)^2.
  - Шаг 3: Магический шепот (Градиенты). Вычисляются градиенты по параметрам:
    - grad*w = 2 * (y*predicted - y) * x
    - grad_b = 2 \* (y_predicted - y)
  - Шаг 4: Коррекция рунических чар. Параметры обновляются противоположно направлению шепота:
    - w = w - learning_rate \* grad_w
    - b = b - learning_rate \* grad_b
  - Шаг 5: Отчет о выстреле. В журнал выводится текущее состояние: номер выстрела, попадание, промах, текущие значения w и b.
- Акт 3: Финальный результат:
  - Печатается финальная калибровка lw (w) и lb (b) и финальный выстрел по мишени с новыми параметрами.

Контекстная легенда: все расчеты ведутся вручную — без графических пакетов, без автоматического градира. Каждая итерация повторяет шаги вычисления и обновления так, чтобы продемонстрировать закон единиц градиента и линейного обновления параметров.

### 4.2. Declarative Content (Для конфигураций и данных)

- Эфир конфигураций:
  - x: начальная позиция мишени (например, 2.0)
  - y: центр мишени (например, 5.0)
  - w: сила натяжения лука (начально 0.0)
  - b: поправка на ветер (начально 0.0)
  - learning_rate: скорость обучения (например, 0.01)
  - epochs: количество повторов (например, 15)
- Эфир данных (для интерфейсов):
  - Входы: x, y, w, b, learning_rate, epochs
  - Выходы: по каждому эпоху — epoch, yPredicted, loss, w, b

## 5. Structural Decomposition (Декомпозиция структуры)

- Главный регистратор Ритуалов (Main Ritual Orchestrator)
  - Инициализация Ритуала (initializeRitual)
  - Вызов Ритуала Пристрелки (executeShots)
  - Финализация и Отчет (finalizeRitual)

- Подмодули / Блоки:
  - Инициализация: установка x, y, w, b, learning_rate, epochs; вывод начальной калибровки и цели.
  - Цикл Выстрелов: расчеты попадания, промаха, градиентов, обновления рунических значений и логирование каждого этапа.
  - Форма Выхода: формирование строки логов на stdout и завершение с финальным состоянием.

- Концептуальные артефакты:
  - Скрижаль Вводов (Inputs)
  - Скрижаль Выходов (Outputs)
  - Ритуальные Лог-линии (stdout reporting)

## 6. System Context & Constraints (Системный контекст и Ограничения)

### 6.1. Technical Constraints

- Performance: Оптимизировано под стандартный CPU. Нет зависимостей от графических ускорителей.
- Concurrency: Синхронный цикл; последовательная обработка без параллелизма.
- Dependencies: Встроенная арифметика Python; без внешних библиотек.

### 6.2. Prohibited Actions (Negative Constraints)

- НЕ хранить секреты в открытом виде и НЕ использовать сетевые вызовы в основном цикле.
- НЕ полагаться на внешние библиотеки для автоградиентов или оптимизации.
- НЕ заключать конфигурационные файлы в скрипты или переходить к встроенным паттернам конфигурации в обход явной декларации.
- НЕ менять версии компонентов или путей реконструкции без явного обоснования.

## 7. Verification & Testing (Верификация)

Герхин-сценарии:
Функционал: Ритуал ручного backpropagation для линейной модели

Scenario: Successful execution
Given валидные входные данные: x=2.0, y=5.0, w=0.0, b=0.0, learning_rate=0.01, epochs=15
When выполняется Ритуал Пристрелки
Then консоль выводит начальную калибровку и 15 строк отчетов по каждому выстрелу, затем Финальную калибровку w и b и Финальный выстрел по мишени

Scenario: Invalid input leads to error
Given некорректные входные данные (например, y отсутствует или нечисловой)
When запускается Ритуал
Then процесс завершается с ненулевым кодом возврата и выводится сообщение об ошибке валидации входных данных

ИССЛЕДУЕМЫЙ АРТЕФАКТ: quest_9_1_manual.py
ИСХОДНЫЙ КОД:
Криптограммный текст описывает ручное приближение к градиентному обучению и не является частью спецификации.
