# === quest_5_1.py ===
# Квест: 5.1 - Выбор свитка знаний
# Цель: Научиться работать с большими архивами (датасетами) в экономном режиме.
# Мы не будем скачивать весь архив целиком, а "простримим" его, чтобы
# извлечь только небольшую часть, необходимую для нашего первого урока Наставления.

# --- Акт 1: Подготовка Гримуара ---

# Призываем "Библиотекаря" (load_dataset) из гримуара 'datasets'.
from datasets import load_dataset

# --- Акт 2: Открытие "Портала" к Архиву ---

# Указываем имя архива в Великой Библиотеке (Hugging Face Hub).
archive_name = "databricks/databricks-dolly-15k"
print(f"Открываю портал к архиву '{archive_name}'...")

# Используем заклинание load_dataset для доступа к архиву.
# 1. archive_name - Имя архива.
# 2. split="train" - Мы хотим получить данные из "тренировочной" части.
# 3. streaming=True - КЛЮЧЕВАЯ РУНА ЭКОНОМИИ! Мы не скачиваем все ~15,000 записей.
#    Мы создаем "портал" (объект IterableDataset), который будет подгружать
#    данные из сети по мере необходимости, по одной записи за раз.
full_dataset = load_dataset(archive_name, split="train", streaming=True, trust_remote_code=True)

# --- Акт 3: Извлечение "Страниц" из Книги ---

print("\nИзвлекаю 100 страниц для нашего урока...")

# Создаем пустой "свиток" (список Python), куда мы сложим наши 100 записей.
# Мы загружаем их в память, так как 100 записей - это очень мало.
small_dataset = []

# Запускаем цикл 'for' для итерации по нашему "порталу".
# `enumerate` - это дух-счетовод, который для каждой записи (sample) также
# выдает ее порядковый номер (i), начиная с 0.
for i, sample in enumerate(full_dataset):
    # Ставим "магический барьер": если номер записи (i) достиг 100...
    if i >= 100:
        # ...то мы прерываем (break) цикл.
        break
    # Если барьер не достигнут, мы добавляем (append) текущую запись в наш "свиток".
    small_dataset.append(sample)
    
# Сообщаем, сколько "страниц" нам удалось переписать.
print(f"Успешно извлечено {len(small_dataset)} записей.")

# --- Акт 4: Просмотр "Страницы" ---

print("\nСмотрим на первую страницу нашего учебного свитка:")
# Берем первый элемент (с индексом 0) из нашего списка.
first_page = small_dataset[0]

# Каждая "страница" (sample) - это словарь. Мы обращаемся к его полям
# по ключам, чтобы посмотреть на структуру наших учебных материалов.
# `instruction` - это задание для Голема.
print("  Инструкция (вопрос):")
print(f"    {first_page['instruction']}")

# `context` - это дополнительная информация (может быть пустой).
print("\n  Контекст (доп. информация):")
print(f"    {first_page['context']}")

# `response` - это "идеальный" ответ, которому мы будем учить нашего Голема.
print("\n  Ответ (чему мы будем учить Голема):")
print(f"    {first_page['response']}")