# quest_20_1.py Specification

## 1. Meta Information

- Domain: ML/NLP
- Complexity: Medium
- Language: Python
- Frameworks: numpy, pandas, matplotlib
- Context: ../AGENTS.md

## 2. Goal & Purpose (Легенда)

Этот Ритуал созерцает и выковывает Эфир времени. Он порождает синтетическую временную линию, состоящую из Тренда, Сезонности и Шума, чтобы служить учебной и тестовой летописям для моделей временных рядов. Скрижаль описывает как управлять структурой данных и как сохранить их в виде CSV и визуального артефакта, пригодного для анализа. Цель — дать полное, контролируемое представление о строении времени и упростить отладку предсказательных моделей.

## 3. Interface Contract (Интерфейсный Контракт)

### 3.1. Inputs (Входы)

- Source: Нет внешних входов (скрипт запускается напрямую)
- Format: Нет внешнего формата ввода
- Schema: InputData — интерфейс без полей (нет внешних параметров)  
  Примечание: код не принимает внешних аргументов и работает по заданным внутри скрипта константам.

### 3.2. Outputs (Выходы)

- Destination: Файлы
- Format: CSV и PNG
- Success Criteria: Exit Code 0
- Schema: OutputResult
  - csvFilename: string
  - plotFilename: string
  - status: string (например, "success" или "failure")

## 4. Implementation Details (The Source DNA / Исходный Код)

### 4.1. Algorithmic Logic (Для исполняемого кода)

Ритуал выполняется по принципу последовательного сотворения трёх эфирных потоков и их сплетения в единую летопись:

1. Инициализация горизонта времени: задаётся число шагов (365) и формируется ось времени от 0 до 364.
2. Травление Великим Потоком: создаётся линейный тренд, пропорциональный времени (0.1 умноженный на индекс шага) для плавного роста.
3. Сотворение Циклов Луны: формируется сезонность через синусоидальную волну с амплитудой 10, повторяющуюся за год.
4. Добавление Капризов Судьбы: создаётся случайный гауссов шум со средним нулём и дисперсией 2.
5. Сплетение компонентов: итоговый временной ряд равняется сумме тренда, сезонности и шума.
6. Обрастание в Эфир: создаётся таблица с двумя колонками — date и value, где date — даты от 2024-01-01 на 365 дней, value — полученные значения.
7. Материализация артефактов: сохранение таблицы в CSV файл time_series_data.csv.
8. Визуализация: построение графика по дата-оси и значению, сохранение изображения time_series_plot.png.
9. Логирование: печать последовательных уведомлений о ходе ритуала и финальном завершении.

### 4.2. Declarative Content (Для конфигураций и данных)

- Параметры артефакта: горизонт времени — 365 шагов; начальная дата — 2024-01-01; тренд — коэффицент 0.1; амплитуда сезонности — 10; шум — нормальное распределение с средним 0 и дисперсией 2.
- Эфир данных: два поля — date (дата) и value (число); формат сохранения — CSV; путь к CSV — time_series_data.csv.
- Визуальный артефакт: time_series_plot.png с графиком линии по оси даты и значений; заголовок графика — Сотворенная Летопись Времени.

## 5. Structural Decomposition (Декомпозиция структуры)

- Импортируемые мантии:
  - matplotlib.pyplot как plt
  - numpy как np
  - pandas как pd
- Главный Ритуал:
  - if **name** == "**main**": запуск магии
- Основные блоки действий:
  - Акт 1: Определение временного горизонта (num_steps, time)
  - Акт 2: Создание Тренда (trend)
  - Акт 3: Создание Сезонности (seasonality)
  - Акт 4: Добавление Шума (noise)
  - Акт 5: Сплетение потоков в Летопись (time_series_values)
  - Акт 6: Материализация Эфира в DataFrame (dates, df)
  - Акт 7: Запись артефактов (CSV)
  - Акт 8: Визуализация и сохранение графического отпечатка (plot)
- Входы и выходы:
  - Ввод отсутствует внешних источников
  - Выводы — два файла: time_series_data.csv и time_series_plot.png

## 6. System Context & Constraints (Системный контекст и Ограничения)

### 6.1. Technical Constraints

- Performance: стандартный CPU; вычисления на NumPy и Пандас
- Concurrency: синхронно, однопоточно
- Dependencies: numpy, pandas, matplotlib

### 6.2. Prohibited Actions (Negative Constraints)

- DO NOT store secrets в открытом виде (использовать .env при необходимости)
- DO NOT выводить сырые данные в консоль в продакшн-режиме
- DO NOT выполнять сетевые вызовы синхронно в главном цикле (не применимо здесь, но следует помнить)
- DO NOT оборачивать конфигурационные файлы (.yaml, .json) в скрипты
- DO NOT менять версии библиотек или пути при реконструировании

## 7. Verification & Testing (Верификация)

Геркин-история 1: Счастливый путь
Feature: Time series data generator
Scenario: Successful execution
Given скрипт quest_20_1.py запускается с настройками по умолчанию
When выполняется весь Ритуал
Then создаются файлы time_series_data.csv и time_series_plot.png и процесс завершается с кодом 0

Геркин-история 2: Ошибка сохранения
Feature: Time series data generator
Scenario: Saving to read-only директория
Given целевая директория недоступна для записи
When скрипт пытается сохранить CSV или PNG
Then процесс завершается с неуспехом и выводится сообщение об ошибке, артефакты не созданы

ИССЛЕДУЕМЫЙ АРТЕФАКТ: quest_20_1.py

ИСТОЧНЫЙ КОД:
Не копировать код: описан выше как последовательность ритуалов, артефактов и их взаимодействие. В тексте сохранены названия библиотек, файлов и структур без повторения программной витиеватости в оригинальном виде.
