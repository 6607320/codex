# Dockerfile Specification

## 1. Meta Information

- **Domain:** Infrastructure
- **Complexity:** Medium
- **Language:** Bash
- **Frameworks:** Docker, Pip, Uvicorn, Torch (PyTorch)
- **Context:** ../AGENTS.md

## 2. Goal & Purpose (–¶–µ–ª—å –∏ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ)

**Context for Creator:** –û–±–µ—Å–ø–µ—á–∏—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è ML-—Å–µ—Ä–≤–∏—Å–∞ –Ω–∞ –±–∞–∑–µ PyTorch —Å CUDA, –≥–æ—Ç–æ–≤—ã–π –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é —á–µ—Ä–µ–∑ Docker.  
**Instruction for AI:** –≠—Ç–æ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –∑–∞–¥–∞—ë—Ç –æ—Å–Ω–æ–≤—É –æ–±—Ä–∞–∑–∞, –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –º–∞—Å—Ç–µ—Ä—Å–∫—É—é (/app), —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ libraries.list, –∫–æ–ø–∏—Ä—É–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ main.py, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Ä—Ç 8000 –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç uvicorn, —á—Ç–æ–±—ã —Å–µ—Ä–≤–∏—Å –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ.

–≠—Ç–æ—Ç Dockerfile –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –Ω–∞–±–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ –≥–æ—Ç–æ–≤—ã–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π –æ–±–ª–∏–∫: —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –±–∞–∑–∞ PyTorch —Å CUDA, –º–∞—Å—Ç–µ—Ä—Å–∫–∞—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ –Ω–∞ –ø–æ—Ä—Ç—É 8000 —á–µ—Ä–µ–∑ uvicorn.

## 3. Interface Contract (–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã–π –ö–æ–Ω—Ç—Ä–∞–∫—Ç)

### 3.1. Inputs (–í—Ö–æ–¥—ã)

- **Source:** CLI Args
- **Format:** Text
- **Schema:**
  interface InputData {
  buildContextPath: string; // –ø—É—Ç—å –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É —Å–±–æ—Ä–∫–∏ (–ø–∞–ø–∫–∞ —Å Dockerfile)
  dockerfileName?: string; // –∏–º—è Dockerfile (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "Dockerfile")
  baseImage?: string; // –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑, –Ω–∞–ø—Ä–∏–º–µ—Ä pytorch/pytorch:2.1.0-cuda11.8-cudnn8-runtime
  librariesListPath?: string; // –ø—É—Ç—å –∫ libraries.list
  appSourcePath?: string; // –ø—É—Ç—å –∫ main.py (–µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–µ–Ω)
  port?: number; // –ø–æ—Ä—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8000
  }

### 3.2. Outputs (–í—ã—Ö–æ–¥—ã)

- **Destination:** API Response
- **Format:** JSON
- **Success Criteria:** Exit Code 0
- **Schema:**
  interface OutputResult {
  imageTag?: string;
  imageId?: string;
  buildLogs: string[]; // –ª–æ–≥ —Å–±–æ—Ä–∫–∏ image
  success: boolean;
  exitCode?: number;
  }

## 4. Implementation Details (The Source DNA / –ò—Å—Ö–æ–¥–Ω—ã–π –ö–æ–¥)

### 4.1. Algorithmic Logic (–î–ª—è –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ –∫–æ–¥–∞)

1. –í—ã–±–∏—Ä–∞–µ—Ç—Å—è –æ—Å–Ω–æ–≤–∞ –æ–±—Ä–∞–∑–∞: –æ—Å–Ω–æ–≤–Ω–æ–π –≤—ã–±–æ—Ä –ø–∞–¥–∞–µ—Ç –Ω–∞ PyTorch —Å CUDA ‚Äî —ç—Ç–æ –≥–ª–∞–≤–Ω—ã–π –∑–∞–∫–ª–∏–Ω–∞—Ç–µ–ª—å–Ω—ã–π —Å–ª–µ–ø–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–¥–∞—ë—Ç –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—É—é –¥–∞–ª—å–Ω–æ—Å—Ç—å –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ.
2. –°–æ–∑–¥–∞—ë—Ç—Å—è —Ä–∞–±–æ—á–∞—è –º–∞—Å—Ç–µ—Ä—Å–∫–∞—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ä–∞–±–æ—á–∏–π –∫–∞—Ç–∞–ª–æ–≥ /app.
3. –ö–æ–ø–∏—Ä—É–µ—Ç—Å—è —Å–≤–∏—Ç–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π libraries.list –≤ –º–∞—Å—Ç–µ—Ä—Å–∫—É—é, —á—Ç–æ–±—ã –¥—É—Ö–æ–≤-–ø–æ–º–æ—â–Ω–∏–∫–æ–≤ –º–æ–∂–Ω–æ –±—ã–ª–æ –ø—Ä–∏–∑–≤–∞—Ç—å –Ω–∞ –º–µ—Å—Ç–æ.
4. –î—É—Ö pip –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–±—Ö–æ–¥ –ø–æ —Å–ø–∏—Å–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–∑ libraries.list –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏—Ö –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –æ–±—Ä–∞–∑–∞ –±–µ–∑ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ª–∏—à–Ω–µ–≥–æ –º—É—Å–æ—Ä–∞.
5. –ß–µ—Ä—Ç—ë–∂ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è main.py –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ –º–∞—Å—Ç–µ—Ä—Å–∫—É—é, —á—Ç–æ–±—ã –∞–º—É–ª–µ—Ç –º–æ–≥ –æ–∂–∏—Ç—å.
6. –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤–æ–ª—à–µ–±–Ω–æ–µ –æ–∫–Ω–æ —Å–≤—è–∑–∏ —Å –≤–Ω–µ—à–Ω–∏–º –º–∏—Ä–æ–º: –ø–æ—Ä—Ç 8000 –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –æ–±—â–µ–Ω–∏—è.
7. –ì–ª–∞–≤–Ω—ã–π –∑–∞–∫–ª–∏–Ω–∞—Ç–µ–ª—å –∂–∏–∑–Ω–∏: –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è uvicorn, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª—É—à–∞–ª–æ –Ω–∞ 0.0.0.0:8000 –∏ –ø—Ä–∏–Ω–∏–º–∞–ª–æ –∑–∞–ø—Ä–æ—Å—ã.
8. –í —Å–ª—É—á–∞–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å —É—Å–ø–µ—Ö–∞ –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–±—Ä–∞–∑–∞; –ª—é–±—ã–µ —Ö–∞–æ—Å—ã —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ –ª–æ–≥–µ –∏ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –Ω–µ—É—Å–ø–µ—Ö—É —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º –≤—ã—Ö–æ–¥–∞.

### 4.2. Declarative Content (–î–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –∏ –¥–∞–Ω–Ω—ã—Ö)

–ò–º—É—â–µ—Å—Ç–≤–æ –∏ –∫–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞, –ø—Ä–µ–≤—Ä–∞—â—ë–Ω–Ω—ã–µ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å:

- üè∞ –û—Å–Ω–æ–≤–∞ –æ–±—Ä–∞–∑–∞: pytorch/pytorch:2.1.0-cuda11.8-cudnn8-runtime
- üè∞ –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –ø—Ä–æ–µ–∫—Ç–∞: /app
- üè∞ –ò—Å—Ç–æ—á–Ω–∏–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: libraries.list
- üè∞ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: main.py
- üõ°Ô∏è –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞: uvicorn main:app --host 0.0.0.0 --port 8000
- üõ°Ô∏è –ü–æ—Ä—Ç –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è: 8000
- üõ°Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–±–æ—Ä–∫–∏: docker (–Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–±–æ—Ä–æ—á–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞) –∏ pip –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- üõ°Ô∏è –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–µ—Ç–∏: EXPOSE 8000
- üõ°Ô∏è –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è: CUDA-—É—Å–∫–æ—Ä–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è host-–≤–µ—Ä—Å–∏–∏ NVIDIA

(–í–∞–∂–Ω–æ: –Ø –Ω–µ –∫–æ–ø–∏—Ä—É—é –∫–æ–¥ –∑–¥–µ—Å—å ‚Äî –æ–ø–∏—Å—ã–≤–∞—é –ª–æ–≥–∏–∫—É –∏ –ø—Ä–µ–¥–º–µ—Ç—ã –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞.)

## 5. Structural Decomposition (–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã)

- –§—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å—ã: –≤ —Ä–∞–º–∫–∞—Ö Dockerfile –∑–¥–µ—Å—å –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–ª–∞—Å—Å—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∫–æ–¥–µ, –Ω–æ –ª–æ–≥–∏–∫–∞ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø—ã —Ä–∏—Ç—É–∞–ª–∞: –≤—ã–±–æ—Ä –æ—Å–Ω–æ–≤—ã, –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π, –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤, –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–∞, –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞.
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: –æ—Å–Ω–æ–≤–∞ –æ–±—Ä–∞–∑–∞, –ø—É—Ç—å –∫ libraries.list, –ø—É—Ç—å –∫ main.py, –ø–æ—Ä—Ç –∏ —ç–∫—Å–ø–æ—Ä—Ç –ø–æ—Ä—Ç–∞.

## 6. System Context & Constraints (–°–∏—Å—Ç–µ–º–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)

### 6.1. Technical Constraints

- **Performance:** GPU-—É—Å–∫–æ—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ CUDA 11.8 –≤ –±–∞–∑–æ–≤–æ–º –æ–±—Ä–∞–∑–µ PyTorch; —Å–±–æ—Ä–∫–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º CUDA –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —Ö–æ—Å—Ç–µ.
- **Concurrency:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –≤ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–µ —á–µ—Ä–µ–∑ uvicorn (Async-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫).
- **Dependencies:** –∫–ª—é—á–µ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: Docker, pip, uvicorn, torch –∏–∑ –æ–±—Ä–∞–∑–∞ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ libraries.list.

### 6.2. Prohibited Actions (Negative Constraints)

- DO NOT —Ö—Ä–∞–Ω–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ .env –∏–ª–∏ —Å–µ–∫—Ä–µ—Ç—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è).
- DO NOT –≤—ã–≤–æ–¥–∏—Ç—å —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–Ω—Å–æ–ª—å –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ.
- DO NOT –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ –≤—ã–∑–æ–≤—ã –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ç–∞–º –¥–æ–ø—É—Å—Ç–∏–º—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã).
- DO NOT –æ–±–æ—Ä–∞—á–∏–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (.yaml, .json) –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
- DO NOT –º–µ–Ω—è—Ç—å –≤–µ—Ä—Å–∏–∏ –∏–ª–∏ –ø—É—Ç–∏ –≤–æ –≤—Ä–µ–º—è —Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞ (–≤–µ—Ä—Å–∏—è –æ–±—Ä–∞–∑–∞ –∏ –ø—É—Ç–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –≤—ã—à–µ).

## 7. Verification & Testing (–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è)

1. –ì–µ—Ä–∫–∏–∞–Ω—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å—á–∞—Å—Ç—å—è –∏ –æ—à–∏–±–∫–∏:

Feature: Dockerfile Build and Run
Scenario: Successful image build and service start
Given build context includes Dockerfile, libraries.list, and main.py
When the image is built using the Dockerfile
Then the image build completes with a successful exit code (0) and a container runs uvicorn on 0.0.0.0:8000

Scenario: Build fails due to missing libraries.list
Given the build context lacks libraries.list
When the image is built
Then the build fails with a non-zero exit code and logs indicate the missing libraries.list

–ò—Ç–æ–≥–æ–≤—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç —É–ø–∞–∫–æ–≤–∞–Ω –∫–∞–∫ –µ–¥–∏–Ω—ã–π, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–π –æ–±—Ä–∞–∑, –≥–æ—Ç–æ–≤—ã–π –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é –≤ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ, –≥–¥–µ —Ç—Ä–µ–±—É—é—Ç—Å—è GPU-—É—Å–∫–æ—Ä–µ–Ω–∏—è –∏ –≤–µ–±-—Å–ª—É–∂–±–∞ –Ω–∞ –±–∞–∑–µ uvicorn.
