# === Dockerfile (ФИНАЛЬНАЯ ВЕРСИЯ с чистой основой) ===
# Имя этого пергамента, хранящего финальную, исправленную версию чертежа.

# Шаг 1: Мы выбираем "основу" от официальной гильдии PyTorch.
# `FROM` — это главное заклинание, которое говорит: "Начни творение с этого готового 'слепка мира'".
# Мы берем "слепок" для PyTorch 2.1.0 с CUDA 11.8.0 на Ubuntu 22.04.
# Это стабильная, проверенная временем комбинация, где вся базовая магия уже настроена.
FROM pytorch/pytorch:2.1.0-cuda11.8-cudnn8-runtime

# Шаг 2: Мы подготавливаем "мастерскую".
# `WORKDIR /app` — это заклинание, которое создает внутри нашего Голема "мастерскую" по имени `/app` и "входит" в нее.
WORKDIR /app
# `COPY requirements.txt .` — мы копируем "свиток с перечнем гримуаров" (`requirements.txt`) из нашего мира в "мастерскую" Голема.
COPY requirements.txt .

# Шаг 3: Мы призываем Гримуары.
# `RUN` — это заклинание, которое исполняет команду внутри Голема.
# Мы больше не удаляем torch, а просто устанавливаем наших помощников.
# `pip install --no-cache-dir -r requirements.txt` — мы приказываем духу `pip` установить все гримуары из нашего свитка, не сохраняя лишнего мусора.
RUN pip install --no-cache-dir -r requirements.txt

# Шаг 4: Мы копируем наш "пергамент".
# `COPY quest_17_1.py .` — мы копируем "чертеж Амулета" (`quest_17_1.py`) из нашего мира в "мастерскую" Голема.
COPY quest_17_1.py .

# Шаг 5 и 6 остаются без изменений.
# `EXPOSE 8000` — это заклинание, которое "прорубает окно" в броне Голема на порту 8000, чтобы мир мог общаться с "Амулетом".
EXPOSE 8000
# `CMD [...]` — это Главное Заклинание Жизни. Оно будет исполнено, когда Голем "оживет".
# Мы приказываем ему запустить "Амулет" с помощью `uvicorn`, чтобы он слушал весь мир (`0.0.0.0`) на порту `8000`.
CMD ["uvicorn", "quest_17_1:app", "--host", "0.0.0.0", "--port", "8000"]
