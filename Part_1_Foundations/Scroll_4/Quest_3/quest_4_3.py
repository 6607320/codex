"""Квест 4.3: Создание GIF-заклинания.

Этот пергамент завершает "Свиток Магии Оживших Кадров", переходя от анализа
к синтезу. Его главная цель (МАКРО-контекст) — освоить магию реконструкции,
собрав отдельные, статичные кадры обратно в единый, движущийся артефакт.

Ритуал использует гримуар `Pillow` для загрузки последовательности
изображений из папки и "сплетения" их в "живую картину" — анимированный
GIF. Этот квест демонстрирует важный навык визуализации результатов
видеоанализа, позволяя создавать легкие и наглядные отчеты о проделанной
работе.
"""

# --- Акт 1: Подготовка Гримуаров ---
# Мы начинаем первый магический акт: призыв знаний из великих библиотек.

# Мы призываем "Духа-Архивариуса" (`os`), который знает всё о файлах и
# папках в нашей системе.
import os

# Мы призываем заклинание `Image` из гримуара `Pillow` — наш главный
# инструмент для работы с образами.
from PIL import Image

# --- Акт 2: Подготовка "Сцены" ---
# Второй акт: мы указываем место, где хранятся наши артефакты-кадры.

# Мы записываем в переменную точное имя папки, где лежат наши "карты-кадры".
frames_folder = "../Quest_1/frames"
# Мы оглашаем на кристалл (консоль) о начале ритуала и месте его проведения.
print(f"Готовлюсь собрать 'Живую Картину' из кадров в папке: {frames_folder}")

# --- Акт 3: Сборка "Колоды" для Анимации ---
# Третий акт: мы находим все нужные кадры и загружаем их в память в
# правильном порядке.

# Это могущественное заклинание (list comprehension),
#  которое собирает пути ко всем нашим кадрам.
# 1. `os.listdir(frames_folder)` — просим Архивариуса дать нам список всего,
#  что есть в папке.
# 2. `for f in ... if f.endswith('.jpg')` — перебираем этот список
# и берем только файлы, чьи имена оканчиваются на `.jpg`.
# 3. `os.path.join(frames_folder, f)` — для каждого имени создаем полный,
#  точный путь (например, 'frames/frame_0.jpg').
# 4. `sorted(...)` — КРИТИЧЕСКИ ВАЖНОЕ ЗАКЛИНАНИЕ! Мы сортируем пути,
# чтобы кадры шли строго по порядку (0, 1, 2...), иначе анимация будет
# хаотичной.
frame_files = sorted(
    [
        os.path.join(frames_folder, f)
        for f in os.listdir(frames_folder)
        if f.endswith(".jpg")
    ]
)

# Мы создаем пустую "магическую стопку" (список Python), куда будем
# складывать загруженные образы.
image_frames = []
# Мы запускаем ритуальный цикл, который пройдет по каждому найденному пути
# к файлу.
for frame_file in frame_files:
    # `Image.open()` — это заклинание, которое "вскрывает" файл
    #  и загружает образ в память.
    # `.append()` — это действие, которое кладет загруженный образ в нашу "стопку".
    image_frames.append(Image.open(frame_file))

# Мы оглашаем на кристалл, сколько "карт" (кадров) было успешно
# подготовлено для ритуала "Оживления".
print(f"Собрано {len(image_frames)} кадров для анимации.")

# --- Акт 4: Ритуал "Оживления" ---
# Четвертый, кульминационный акт: мы сплетаем отдельные кадры в единое целое.

# Согласно древнему канону гримуара Pillow,
#  для создания GIF мы берем первый кадр как "основу".
# `image_frames[0]` — это заклинание "взять самый первый элемент" из нашей стопки.
first_frame = image_frames[0]

# Мы используем метод `.save()` нашего первого кадра, но наделяем его
# дополнительными "магическими рунами".
first_frame.save(
    # 1. 'animated_cat.gif' — Имя, которое мы даруем нашему новому артефакту.
    "animated_cat.gif",
    # 2. format='GIF' — Явно указываем, что хотим создать артефакт в формате
    # "Живой Картины" (GIF).
    format="GIF",
    # 3. append_images=image_frames[1:] — КЛЮЧЕВАЯ РУНА!
    #  Мы "приклеиваем" к первому кадру
    #    все остальные. `image_frames[1:]` — означает "взять все кадры,
    #  начиная со второго".
    append_images=image_frames[1:],
    # 4. save_all=True — Руна-подтверждение:
    #  "Да, сохрани все 'приклеенные' кадры, а не только первый".
    save_all=True,
    # 5. duration=200 — Руна Времени: устанавливаем,
    #  что каждый кадр будет виден 200 миллисекунд.
    duration=200,
    # 6. loop=0 — Руна Вечности: 0 — это специальное значение,
    #  приказывающее "зациклить анимацию навечно".
    loop=0,
)

# --- Акт 5: Завершение ---
# Финальный акт: мы оглашаем об успешном сотворении артефакта.

# Мы сообщаем Магу-Техноманту, что ритуал завершен и "Живая Картина"
# материализована.
print("\nМагия свершилась! 'Живая Картина' сохранена в файл 'animated_cat.gif'")
