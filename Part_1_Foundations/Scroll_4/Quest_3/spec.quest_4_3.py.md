# quest_4_3.py Specification

## 1. Meta Information

- Domain: Scripting
- Complexity: Low
- Language: Python
- Frameworks: Pillow
- Context: ../Quest_1/README.md

## 2. Goal & Purpose (Легенда и Назначение)

Легенда: Этот Ритуал собирает отдельные кадры из папки в единое живое изображение — GIF-заклинание, визуализирующее результаты анализа кадров. Он демонстрирует способность реконструировать последовательности в наглядный артефакт, превращая статические Эфиры в движущийся рассказ.

## 3. Interface Contract (Интерфейсный Контракт)

### 3.1. Inputs (Входы)

- Source: CLI Args | STDIN | API Request | Kafka Topic | Smart Contract Call
- Format: JSON | Text | Binary | Stream
- Schema: Входные данные для этого скрипта в сущности отсутствуют на уровне внешних входов; скрипт использует внутренние конфигурации и константы (рискует считать, что внешних входов нет).

### 3.2. Outputs (Выходы)

- Destination: File
- Format: GIF
- Success Criteria: File Created
- Schema (OutputResult): структура описывает результат выполнения и путь к создаваемому артефакту
  - path: string
  - format: string
  - framesCount: number
  - durationPerFrameMs: number
  - loop: number
  - success: boolean

## 4. Implementation Details (The Source DNA / Исходный Код)

### 4.1. Algorithmic Logic (Для исполняемого кода)

1. Подготовка ритуалов — подключаем Дух-Архивариуса (os) и заклинание Image из гримуара Pillow.
2. Адресация сцены — задаем место, где лежат кадры: frames_folder равно "../Quest_1/frames".
3. Прежний зов к свету — выводим сообщение о начале ритуала и месте проведения.
4. Формирование колоды кадров — собираем полный путь ко всем файлам в frames_folder, отбираем только файлы с суффиксом .jpg и сортируем их по имени, чтобы порядок был точным.
5. Вызов Хаоса и создание стопки — последовательно прогружаем каждый кадр через Image.open и кладем образ в коллекцию image_frames.
6. Открытие и свершение — берём первый кадр как основу и сохраняем его как animated_cat.gif, добавляя к нему все остальные кадры через append_images, устанавливая save_all=True, duration=200 миллисекунд на кадр и loop=0 (бесконечное повторение).
7. Завершение ритуала — выводим сообщение о успешном создании анимации и лежащего файла.

### 4.2. Declarative Content (Для конфигураций и данных)

Это часть конфигураций и фиксированных данных, которые позволяют воссоздать артефакт 1-в-1:

- frames_folder: ../Quest_1/frames — место размещения исходных кадров
- frame_extension_filter: .jpg — формат файлов, которые включаются в GIF
- output_file: animated_cat.gif — имя создаваемого GIF-артефакта
- duration_per_frame_ms: 200 — длительность показа каждого кадра в миллисекундах
- loop: 0 — вечное повторение GIF-заклинания
- принятый порядок кадров: по именам файлов в frames_folder после сортировки

## 5. Structural Decomposition (Декомпозиция структуры)

- Импорт и предварительная настройка
  - Основа импорта модулей os и PIL.Image
  - Константа frames_folder
- Подготовка сцены
  - Выводит сообщение о начале ритуала
- Сборка колоды кадров
  - Получение списка файлов в frames_folder
  - Фильтрация по расширению .jpg
  - Формирование полных путей и сортировка
- Загрузка образов
  - Прочитывание каждого кадра через Image.open
  - Помещение образов в image_frames
- Ритуал оживления
  - Выделение первого кадра как основы
  - Сохранение GIF с append_images, save_all, duration и loop
- Завершение
  - Сообщение об успешном создании animated_cat.gif

## 6. System Context & Constraints (Системный контекст и Ограничения)

### 6.1. Technical Constraints

- Performance: Оптимизировано под стандартный CPU; память зависит от количества кадров, загруженных в память.
- Concurrency: Однопоточность (Sync) — выполнено последовательно.
- Dependencies: Pillow (для работы с изображениями), стандартная библиотека os.

### 6.2. Prohibited Actions (Negative Constraints)

- DO NOT хранить секреты в открытом виде в конфигурациях.
- DO NOT выводить сырые данные в консоль в продакшн-режиме.
- DO NOT выполнять сетевые вызовы синхронно в основной цикл ритуала.
- DO NOT упаковывать конфигурационные файлы (.yaml, .json) внутрь скриптов как часть исполняемого артефакта.
- DO NOT менять версии библиотек или пути во время реконструкции артефакта.

## 7. Verification & Testing (Верификация)

Герхин-сценарии

Функциональность Script: Радужный Когтер (Script Functionality)
Сценарий: Успешное выполнение
Дано существующие кадры в папке ../Quest_1/frames и корректные PNG/JPG кадры
Когда выполняется ритуал и создается animated_cat.gif
Тогда файл animated_cat.gif появляется в файловой системе и содержит множество кадров

Функциональность Script: Радужный Когтер (Script Functionality)
Сценарий: Ошибка отсутствия кадров
Дано папка frames пустая или не существует
Когда выполняется ритуал
Тогда процесс завершается с сохранением сообщений об ошибке и отсутствием созданного GIF-файла

Контекст: quest_4_3.py Artifacts взаимодействуют с Quest_1, опираясь на кадры из ../Quest_1/frames и формируя итоговый GIF-артефакт. Independent Artifact не требуется.
