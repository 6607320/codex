# quest_8_1.py Specification

## 1. Meta Information

- **Domain:** Scripting
- **Complexity:** Low
- **Language:** Python
- **Frameworks:** OpenCV (cv2), Python Standard Library (os)
- **Context:** ../AGENTS.md

## 2. Goal & Purpose (Цель и Назначение)

**Context for Creator:** Этот артефакт реализует технику прореживания кадров в видеоролике для экономии вычислительных ресурсов: считывает видеопоток, выбирает каждый N-ый кадр и сохраняет его как отдельный файл, минимизируя переработку целей и усиливая производительность анализа. В примере задан путь к видео test_video.mp4 и выходную папку sampled_frames, где каждый третий кадр сохраняется как frame_X.jpg.  
**Instruction for AI:** Это задание задает WHY: зачем нужен модуль — снизить нагрузку на обработку видео за счет выборочного извлечения кадров и подготовки их для последующего анализа или демонстрации.

Описание на русском языке: Этот модуль призван демонстрировать базовую технику Frame Sampling: он открывает видео файл, последовательно считывает кадры, и каждый N-й кадр сохраняет в указанную папку под уникическим именем, при этом ведутся подсчеты общего числа считанных кадров и сохранённых кадров. В конце ритуала выводится сводка в поток Эфира (STDOUT).

## 3. Interface Contract (Интерфейсный Контракт)

### 3.1. Inputs (Входы)

- **Source:** CLI Args
- **Format:** Text
- **Schema:**
  interface InputData {
  videoPath: string;
  outputFolder: string;
  frameSkip: number;
  }

### 3.2. Outputs (Выходы)

- **Destination:** STDOUT
- **Format:** JSON
- **Success Criteria:** Exit Code 0
- **Schema:**
  interface OutputResult {
  totalFramesRead: number;
  framesSaved: number;
  outputFolder: string;
  videoPath: string;
  }

## 4. Implementation Details (The Source DNA / Исходный Код)

### 4.1. Algorithmic Logic (Для исполняемого кода)

- В начале запускаются необходимые духовные инструменты: подключаются модули os и cv2, как свитки, хранящие знания о файлах и видеопотоке.
- Гримуар прореживания активирует Скрижаль параметров: задаётся имя папки для размещения прореженных кадров (outputFolder) и создаётся эта папка, если она ещё не существует.
- Задаётся главный параметр прореживания frameSkip, здесь равный 3, который станет магическим фильтром для отбора кадров.
- Ритуал начинается: открывается видеопоток через видеоплеер OpenCV, путь к файлу фиксирован как test_video.mp4; на кристалл выводится сообщение о старте.
- В бесконечном цикле читается следующий кадр. Если чтение неудачно — цикл прерывается, поток считается завершённым.
- Счётчик totalFramesRead увеличивается на единицу каждый раз, когда кадр прочитан.
- Магическая проверка: если totalFramesRead делится на frameSkip без остатка, выполняется сохранение текущего кадра.
  - Формируется уникальное имя кадра frame\_{frames_saved}.jpg в указанной папке.
  - Текущий кадр сохраняется на диск по этому пути.
  - Счётчик framesSaved увеличивается на единицу.
- После выхода из цикла освобождается ресурс видеопотока и выводится сводка: общее прочитанное количество кадров и количество сохранённых кадров, с указанием папки вывода и шага прореживания.

### 4.2. Declarative Content (Для конфигураций и данных)

- outputFolder: "sampled_frames"
- frameSkip: 3
- videoPath: "test_video.mp4"
- Спецификации: используются библиотеки os и cv2; кадры сохраняются по шаблону frame\_{frames_saved}.jpg; основная информация печатается в STDOUT.
- Ритуал завершается выводом сводки: количество пройденных кадров и сохранённых кадров, а также путь к выходной папке.

## 5. Structural Decomposition (Декомпозиция структуры)

- Импортируемые модули: os, cv2
- Глобальные параметры: outputFolder, frameSkip
- Подготовка структуры хранения кадров: os.makedirs(outputFolder, exist_ok=True)
- Видеоподключение: videoCapture = cv2.VideoCapture(videoPath)
- Переменные учёта: totalFramesRead, framesSaved
- Основной цикл обработки кадров: чтение кадра, проверка успеха, счётчик, фильтр по остатка от деления, сохранение кадра
- Завершение ритуала: release видеопотока, вывод сводки

## 6. System Context & Constraints (Системный контекст и Ограничения)

### 6.1. Technical Constraints

- **Performance:** Standard CPU
- **Concurrency:** Sync (однопоточная последовательная обработка)
- **Dependencies:** opencv-python (cv2), Python стандартной библиотеки

### 6.2. Prohibited Actions (Negative Constraints)

- DO NOT хранить секреты в открытом виде (не применимо здесь, но правило остается).
- DO NOT выводить сырые данные в консоль в продакшн-режиме.
- DO NOT совершать синхронные сетевые вызовы в главном цикле.
- DO NOT оборачивать конфигурационные файлы (.yaml, .json) в скрипты.
- DO NOT менять версии или пути реконструкции без явной необходимости.

## 7. Verification & Testing (Верификация)

Герхин-сценарии (1–2 happy path, один негативный)

Feature: Frame Sampling Script
Scenario: Successful execution
Given файл видеоролика "test_video.mp4" существует и доступна папка вывода "sampled_frames"
When скрипт запускается и выполняет прореживание
Then будет сохранено кадров: каждый третий кадр, в папке "sampled_frames", с общим количеством обработанных кадров и сохранённых кадров выведено на STDOUT как сводка

Scenario: Video file отсутствует
Given файл видеоролика "test_video.mp4" отсутствует
When скрипт запускается
Then процесс завершается с нулём сохранённых кадров и нулём прочитанных кадров, выводится сообщение о завершении и сводке (при этом код исполнения остаётся корректным)

ИССЛЕДУЕМЫЙ АРТЕФАКТ: quest_8_1.py

ИСХОДНЫЙ КОД:
См. оригинальный текст артефакта выше.
