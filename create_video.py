# === create_video.py ===
# Квест: Часть Ритуала для Квеста 4.1
# Цель: Создать простой видеофайл из одного изображения.
# Этот скрипт демонстрирует, как программно записывать видео,
# что является основой для сохранения любых результатов видеоаналитики.

# --- Акт 1: Подготовка Гримуаров и Артефактов ---

# Призываем "Набор Кинематографиста" (OpenCV) для работы с видео.
import cv2
# Призываем помощника для работы с массивами чисел (numpy), он нужен для создания матрицы сдвига.
import numpy as np

# --- Акт 2: Загрузка "Актера" и Измерение "Сцены" ---

# Используем заклинание imread ("image read") для загрузки нашего артефакта.
# В этот момент картинка превращается в numpy-массив чисел, понятный для cv2.
img = cv2.imread('magical_cat.png')

# Используем свойство .shape, чтобы узнать размеры нашего "актера".
# Оно возвращает три значения: (высота, ширина, количество цветовых каналов).
# Нам нужны только высота и ширина.
height, width, layers = img.shape

# Создаем "мерку" (кортеж) с размерами в том порядке, который требует VideoWriter: (ширина, высота).
size = (width, height)

# --- Акт 3: Подготовка "Кинопленки" ---

# cv2.VideoWriter - это главное заклинание для создания видео.
# Мы создаем "объект-рекордер", который будет записывать кадры в файл.
# Ему нужно передать 4 инструкции:
# 1. 'test_video.mp4' - Имя файла, в который будет вестись запись.
# 2. cv2.VideoWriter_fourcc(*'mp4v') - "Кодек", магическая формула сжатия. 'mp4v' - стандарт для .mp4.
# 3. 1 - "FPS" (Frames Per Second), количество кадров в секунду. Ставим 1 для очень медленного видео.
# 4. size - Размер "сцены" (кадра), который мы измерили ранее.
out = cv2.VideoWriter('test_video.mp4', cv2.VideoWriter_fourcc(*'mp4v'), 1, size)

# --- Акт 4: Ритуал Записи ---

# Мы используем цикл, чтобы повторить действие несколько раз.
# range(10) создаст последовательность от 0 до 9.
for i in range(10):
    # out.write() - это заклинание, которое берет образ (numpy-массив)
    # и записывает его как один кадр на нашу "кинопленку".
    # Мы 10 раз записываем один и тот же образ.
    out.write(img)

# --- Акт 5: Завершение ---

# out.release() - критически важное заклинание!
# Оно приказывает рекордеру "завершить запись, сохранить все данные и освободить файл".
# Без него видеофайл может получиться поврежденным или пустым.
out.release()

# Финальное сообщение в консоль о том, что ритуал прошел успешно.
print("Магическая кинопленка 'test_video.mp4' создана.")