"""–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: –°—Ç—Ä–æ–∏—Ç–µ–ª—å "–ñ–∏–≤–æ–π –õ–µ—Ç–æ–ø–∏—Å–∏" –¥–ª—è `–û—Ä–∞–∫—É–ª–∞-–ê—Ä—Ö–∏–≤–∞—Ä–∏—É—Å–∞`.

–≠—Ç–æ—Ç –ø–µ—Ä–≥–∞–º–µ–Ω—Ç ‚Äî –Ω–µ —É—á–µ–±–Ω—ã–π –ö–≤–µ—Å—Ç, –∞ **"–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ú–∞—Å—Ç–µ—Ä–∞"**. –ï–≥–æ –≥–ª–∞–≤–Ω–∞—è
—Ü–µ–ª—å (–ú–ê–ö–†–û-–∫–æ–Ω—Ç–µ–∫—Å—Ç) ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å "–í–µ–ª–∏–∫–∏–π –ö–æ–¥–µ–∫—Å –¢–µ—Ö–Ω–æ–º–∞–≥–∏–∏",
–Ω–∞—Ö–æ–¥–∏—Ç—å –≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã (`.py`, `.md`, `.yml` –∏ –¥—Ä.), –∏ —Å–æ–±–∏—Ä–∞—Ç—å
–∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ —Å–µ—Ä–∏—é PDF-—Ç–æ–º–æ–≤ (`notebooklm_sources/`).

–≠—Ç–∏ PDF-—Ç–æ–º–∞ —Å–ª—É–∂–∞—Ç **–∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∑–Ω–∞–Ω–∏–π** –¥–ª—è –Ω–∞—à–µ–≥–æ `–û—Ä–∞–∫—É–ª–∞-–ê—Ä—Ö–∏–≤–∞—Ä–∏—É—Å–∞`
(RAG-—Å–∏—Å—Ç–µ–º—ã –Ω–∞ –±–∞–∑–µ NotebookLM), –ø—Ä–µ–≤—Ä–∞—â–∞—è –µ–≥–æ –≤ –±–µ–∑—É–ø—Ä–µ—á–Ω—É—é, –≤—Å–µ–≥–¥–∞
–∞–∫—Ç—É–∞–ª—å–Ω—É—é "–∂–∏–≤—É—é" –ø–∞–º—è—Ç—å –æ –ö–æ–¥–µ–∫—Å–µ. –†–∏—Ç—É–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ: –æ–Ω
–æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–∞—Ö —Å –ø–æ–º–æ—â—å—é "–ø–µ—á–∞—Ç–µ–π" (—Ö–µ—à–µ–π) –≤ `manifest.json`
–∏ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–æ—Ç —Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –∑–∞—Ç—Ä–æ–Ω—É—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏.
"""

# –ü—Ä–∏–∑—ã–≤–∞–µ–º –¥—É—Ö–∞ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã `os` –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Ñ–∞–π–ª–∞–º–∏ –∏
# –ø—É—Ç—è–º–∏.
import os

# –ü—Ä–∏–∑—ã–≤–∞–µ–º –¥—É—Ö–∞ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏ `hashlib` –¥–ª—è —Å–æ—Ç–≤–æ—Ä–µ–Ω–∏—è –Ω–µ—Ä—É—à–∏–º—ã—Ö –ø–µ—á–∞—Ç–µ–π
# (—Ö–µ—à–µ–π).
import hashlib

# –ü—Ä–∏–∑—ã–≤–∞–µ–º –¥—É—Ö–∞ —Ñ–æ—Ä–º–∞—Ç–∞ JSON –¥–ª—è —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏ –Ω–∞—à–µ–π –õ–µ—Ç–æ–ø–∏—Å–∏.
import json

# –ò–∑ –≤–µ–ª–∏–∫–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `fpdf` –ø—Ä–∏–∑—ã–≤–∞–µ–º —Å—É—â–Ω–æ—Å—Ç—å `FPDF`, –Ω–∞—à–µ–≥–æ
# –î—É—Ö–∞-–ö–∞–ª–ª–∏–≥—Ä–∞—Ñ–∞.
from fpdf import FPDF

# –ü—Ä–∏–∑—ã–≤–∞–µ–º —Å—É—â–Ω–æ—Å—Ç–∏ –∏–∑ `typing` –¥–ª—è –Ω–∞–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Ä–∏—Ç—É–∞–ª—ã —Ä—É–Ω —è—Å–Ω–æ—Å—Ç–∏
# (–∞–Ω–Ω–æ—Ç–∞—Ü–∏–π —Ç–∏–ø–æ–≤).
from typing import List, Dict, Any, Set

# --- –ù–µ–∑—ã–±–ª–µ–º—ã–µ –ó–∞–∫–æ–Ω—ã (–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã) ---
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ü—É—Ç—å –∫ –∫–æ—Ä–Ω—é –í–µ–ª–∏–∫–æ–≥–æ –ö–æ–¥–µ–∫—Å–∞, –≥–¥–µ –Ω–∞—á–Ω–µ—Ç—Å—è –í–µ–ª–∏–∫–∏–π –û–±—Ö–æ–¥.
PROJECT_DIR = "../../"
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ü—É—Ç—å –¥–ª—è –ê—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ (—Ç–µ–∫—É—â–∞—è –ø–∞–ø–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞)
ARTEFACTS_DIR = "."
# –ù–∞—á–µ—Ä—Ç–∞–µ–º –ß–µ—Ä–Ω—ã–π –°–ø–∏—Å–æ–∫ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∏—Ç—É–∞–ª —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–ª–∂–µ–Ω
# –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å.
EXCLUDE_DIRS = {
    ".git",
    ".dvc",
    "__pycache__",
    ".pytest_cache",
    "build",
    "dist",
    "notebooklm_sources",
}
# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ò—Å—Ç–∏–Ω–Ω—ã–µ –ò–º–µ–Ω–∞ –†–∞—Å—à–∏—Ä–µ–Ω–∏–π —Ç–µ—Ö —Å–≤–∏—Ç–∫–æ–≤, —á—Ç–æ –¥–æ—Å—Ç–æ–π–Ω—ã –Ω–∞—à–µ–≥–æ
# –≤–Ω–∏–º–∞–Ω–∏—è.
TARGET_EXTENSIONS = (
    ".py",
    ".md",
    ".txt",
    ".json",
    ".yml",
    ".yaml",
    ".spec",
    ".sh",
    ".mono",
    ".html",
    ".css",
    ".js",
)
# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ò—Å—Ç–∏–Ω–Ω—ã–µ –ò–º–µ–Ω–∞ –æ—Å–æ–±—ã—Ö —Å–≤–∏—Ç–∫–æ–≤, —á—Ç–æ –Ω–µ –∏–º–µ—é—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π, –Ω–æ
# —Ç–∞–∫–∂–µ –≤–∞–∂–Ω—ã.
TARGET_FILES = (
    "Dockerfile",
    ".gitignore",
    ".dvcignore",
    ".flake8",
    "LICENSE",
    "NOTICE",
)
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ü—É—Ç—å –∫ –≥–ª–∞–≤–Ω–æ–º—É —Å–≤–∏—Ç–∫—É –õ–µ—Ç–æ–ø–∏—Å–∏, `manifest.json`.
MANIFEST_FILE = "manifest.json"
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ü—É—Ç—å –∫ –•—Ä–∞–Ω–∏–ª–∏—â—É –¢–æ–º–æ–≤, –≥–¥–µ –±—É–¥—É—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω—ã PDF-—Å–≤–∏—Ç–∫–∏.
OUTPUT_DIR = "notebooklm_sources"
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞–≥–∏—á–µ—Å–∫–∏–π –õ–∏–º–∏—Ç –°–ª–æ–≤ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∞—Ä—Ö–∏–≤–Ω–æ–≥–æ PDF-—Ç–æ–º–∞.
WORD_LIMIT = 475000
# –î–∞–µ–º –ò—Å—Ç–∏–Ω–Ω–æ–µ –ò–º—è –Ω–∞—à–µ–º—É –≤–µ—á–Ω–æ –º–µ–Ω—è—é—â–µ–º—É—Å—è ¬´–ñ–∏–≤–æ–º—É –¢–æ–º—É¬ª.
LIVING_CHUNK_FILENAME = (
    "living_chronicle.pdf"  # –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –∏–º—è –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–æ–º–∞ ###
)


# --- –ú–∞–ª—ã–µ –†–∏—Ç—É–∞–ª—ã (–§—É–Ω–∫—Ü–∏–∏) ---
# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∏—Ç—É–∞–ª `calculate_sha256` –¥–ª—è –ù–∞–ª–æ–∂–µ–Ω–∏—è –ü–µ—á–∞—Ç–∏.
def calculate_sha256(filepath: str) -> str:
    # –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞–≥–∏—á–µ—Å–∫–∏–π –∫–æ—Ç–µ–ª –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –Ω–µ—Ä—É—à–∏–º–æ–π –ø–µ—á–∞—Ç–∏ SHA256.
    sha256_hash = hashlib.sha256()
    # –ù–∞—á–∏–Ω–∞–µ–º —Ä–∏—Ç—É–∞–ª –ø–æ–¥ –∑–∞—â–∏—Ç–æ–π –æ—Ö—Ä–∞–Ω–Ω—ã—Ö —Ä—É–Ω –Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–æ–∫ —á—Ç–µ–Ω–∏—è.
    try:
        # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–≤–∏—Ç–æ–∫ –≤ –±–∏–Ω–∞—Ä–Ω–æ–º —Ä–µ–∂–∏–º–µ (`"rb"`) –¥–ª—è —á—Ç–µ–Ω–∏—è –µ–≥–æ –ø–ª–æ—Ç–∏ –∫–∞–∫
        # –µ—Å—Ç—å.
        with open(filepath, "rb") as f:
            # –ß–∏—Ç–∞–µ–º —Å–≤–∏—Ç–æ–∫ –ø–æ —á–∞—Å—Ç—è–º (–±–ª–æ–∫–∞–º–∏ –ø–æ 4096 –±–∞–π—Ç), —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å
            # –ø–∞–º—è—Ç—å.
            for byte_block in iter(lambda: f.read(4096), b""):
                # –ö–∞–∂–¥—É—é –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—É—é —á–∞—Å—Ç—å –±—Ä–æ—Å–∞–µ–º –≤ –∫–æ—Ç–µ–ª, –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Ñ–æ—Ä–º–∏—Ä—É—è
                # –ø–µ—á–∞—Ç—å.
                sha256_hash.update(byte_block)
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≥–æ—Ç–æ–≤—É—é –ø–µ—á–∞—Ç—å –≤ –≤–∏–¥–µ —à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–µ—Ä–∏—á–Ω–æ–π —Ç–µ–∫—Å—Ç–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏.
        return sha256_hash.hexdigest()
    # –ï—Å–ª–∏ —Ä–∏—Ç—É–∞–ª —á—Ç–µ–Ω–∏—è —Å–≤–∏—Ç–∫–∞ –±—ã–ª –ø—Ä–µ—Ä–≤–∞–Ω –æ—à–∏–±–∫–æ–π...
    except IOError:
        # ...–≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ—Ç—É –∫–∞–∫ –∑–Ω–∞–∫ –Ω–µ—É–¥–∞—á–∏.
        return ""


# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∏—Ç—É–∞–ª `scan_project_files` –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –í–µ–ª–∏–∫–æ–≥–æ –û–±—Ö–æ–¥–∞
# –ö–æ–¥–µ–∫—Å–∞.
def scan_project_files(
    directory: str, extensions: tuple, filenames: tuple, exclude_dirs: set
) -> List[str]:
    # –ì–æ—Ç–æ–≤–∏–º –ø—É—Å—Ç–æ–π –º–∞–≥–∏—á–µ—Å–∫–∏–π –º–µ—à–æ–∫ –¥–ª—è —Å–±–æ—Ä–∞ –ø—É—Ç–µ–π –∫–æ –≤—Å–µ–º –¥–æ—Å—Ç–æ–π–Ω—ã–º
    # —Å–≤–∏—Ç–∫–∞–º.
    all_files = []
    # –ù–∞—á–∏–Ω–∞–µ–º –í–µ–ª–∏–∫–∏–π –û–±—Ö–æ–¥ –ö–æ–¥–µ–∫—Å–∞ —Å –ø–æ–º–æ—â—å—é –¥—É—Ö–∞ `os.walk`.
    for root, dirs, files in os.walk(directory, topdown=True):
        # –ò–∑–≥–æ–Ω—è–µ–º –ø–∞–ø–∫–∏ –∏–∑ –ß–µ—Ä–Ω–æ–≥–æ –°–ø–∏—Å–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ `dirs` –Ω–∞ –ª–µ—Ç—É, —á—Ç–æ–±—ã
        # `os.walk` –≤ –Ω–∏—Ö –Ω–µ –∑–∞—Ö–æ–¥–∏–ª.
        dirs[:] = [d for d in dirs if d not in exclude_dirs]
        # –í –∫–∞–∂–¥–æ–π –ø–æ—Å–µ—â–µ–Ω–Ω–æ–π –ø–∞–ø–∫–µ –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –≤ –Ω–µ–π —Å–≤–∏—Ç–∫–∏.
        for file in files:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –∏–º—è —Å–≤–∏—Ç–∫–∞ –Ω–∞—à–∏–º –ò—Å—Ç–∏–Ω–Ω—ã–º –ò–º–µ–Ω–∞–º–∏.
            if file.endswith(extensions) or file in filenames:
                # –°–æ–µ–¥–∏–Ω—è–µ–º –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ (`root`) –∏ –∏–º—è —Å–≤–∏—Ç–∫–∞ (`file`), —Å–æ–∑–¥–∞–≤–∞—è –ø–æ–ª–Ω—ã–π
                # –ø—É—Ç—å.
                filepath = os.path.join(root, file)
                # –ü–æ–º–µ—â–∞–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–π –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å –≤ –Ω–∞—à –º–∞–≥–∏—á–µ—Å–∫–∏–π –º–µ—à–æ–∫.
                all_files.append(filepath)
    # –ù–∞—á–∏–Ω–∞–µ–º —Ä–∏—Ç—É–∞–ª –ø–æ–¥ –∑–∞—â–∏—Ç–æ–π –æ—Ö—Ä–∞–Ω–Ω—ã—Ö —Ä—É–Ω.
    try:
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ —Å–∞–º–æ–º—É —ç—Ç–æ–º—É –ø–µ—Ä–≥–∞–º–µ–Ω—Ç—É
        # (`rag_builder.py`).
        script_path = os.path.abspath(__file__)
        # –ò–∑–≥–æ–Ω—è–µ–º –ø—É—Ç—å –∫ —Å–∞–º–æ–º—É —Å–µ–±–µ –∏–∑ —Å–ø–∏—Å–∫–∞, –∏–±–æ —Ä–∏—Ç—É–∞–ª –Ω–µ –¥–æ–ª–∂–µ–Ω
        # –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∞–º —Å–µ–±—è.
        all_files = [f for f in all_files if os.path.abspath(f) != script_path]
    # –ï—Å–ª–∏ —Ä–∏—Ç—É–∞–ª –∑–∞–ø—É—â–µ–Ω –≤ —Å—Ä–µ–¥–µ, –≥–¥–µ `__file__` –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω...
    except NameError:
        # ...–ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—è.
        pass
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É —Å–ø–∏—Å–æ–∫ –ø—É—Ç–µ–π –¥–ª—è –ø–æ—Ä—è–¥–∫–∞ –∏
    # –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏.
    return sorted(all_files)


# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∏—Ç—É–∞–ª `load_manifest` –¥–ª—è —á—Ç–µ–Ω–∏—è –¥—Ä–µ–≤–Ω–µ–π –õ–µ—Ç–æ–ø–∏—Å–∏.
def load_manifest(manifest_path: str) -> Dict[str, Any]:
    # –ù–∞—á–∏–Ω–∞–µ–º —Ä–∏—Ç—É–∞–ª –ø–æ–¥ –∑–∞—â–∏—Ç–æ–π –æ—Ö—Ä–∞–Ω–Ω—ã—Ö —Ä—É–Ω –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –õ–µ—Ç–æ–ø–∏—Å—å –µ—â–µ –Ω–µ
    # —Å–æ—Ç–≤–æ—Ä–µ–Ω–∞.
    try:
        # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–≤–∏—Ç–æ–∫ –õ–µ—Ç–æ–ø–∏—Å–∏ –¥–ª—è —á—Ç–µ–Ω–∏—è —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π UTF-8.
        with open(manifest_path, "r", encoding="utf-8") as f:
            # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ç–µ–∫—Å—Ç —Å–≤–∏—Ç–∫–∞ –∏–∑ JSON –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º
            # –µ—ë.
            return json.load(f)
    # –ï—Å–ª–∏ –õ–µ—Ç–æ–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –∏—Å–∫–∞–∂–µ–Ω–∞...
    except (FileNotFoundError, json.JSONDecodeError):
        # ...—Å–æ—Ç–≤–æ—Ä—è–µ–º –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–æ–≤—É—é, –ø—É—Å—Ç—É—é –õ–µ—Ç–æ–ø–∏—Å—å –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
        return {"files": {}, "chunks": []}


# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∏—Ç—É–∞–ª `save_manifest` –¥–ª—è –∑–∞–ø–µ—á–∞—Ç—ã–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –õ–µ—Ç–æ–ø–∏—Å–∏.
def save_manifest(manifest_path: str, data: Dict[str, Any]):
    # –°–æ–±–∏—Ä–∞–µ–º –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å –∫ –õ–µ—Ç–æ–ø–∏—Å–∏ (–≤ –ø–∞–ø–∫–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞).
    manifest_root_path = os.path.join(ARTEFACTS_DIR, manifest_path)
    # –°–æ—Ç–≤–æ—Ä—è–µ–º –Ω—É–∂–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –õ–µ—Ç–æ–ø–∏—Å–∏, –µ—Å–ª–∏ –æ–Ω–∞ –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
    os.makedirs(os.path.dirname(manifest_root_path) or ".", exist_ok=True)
    # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–≤–∏—Ç–æ–∫ –õ–µ—Ç–æ–ø–∏—Å–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π UTF-8.
    with open(manifest_root_path, "w", encoding="utf-8") as f:
        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –Ω–∞—à–∏ –∑–Ω–∞–Ω–∏—è –≤ —Å–≤–∏—Ç–æ–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏.
        json.dump(data, f, indent=4, ensure_ascii=False)


# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∏—Ç—É–∞–ª `create_pdf_from_text` –¥–ª—è —Å–æ—Ç–≤–æ—Ä–µ–Ω–∏—è PDF-—Ç–æ–º–∞.
def create_pdf_from_text(text_content: str, output_path: str):
    # –û–ø–æ–≤–µ—â–∞–µ–º –ú–∞–≥–∞-–¢–µ—Ö–Ω–æ–º–∞–Ω—Ç–∞ –æ –Ω–∞—á–∞–ª–µ —Å–æ—Ç–≤–æ—Ä–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ç–æ–º–∞.
    print(f"–°–æ–∑–¥–∞–Ω–∏–µ PDF –ø–æ –ø—É—Ç–∏ {output_path}...")
    # –ù–∞—á–∏–Ω–∞–µ–º —Ä–∏—Ç—É–∞–ª –ø–æ–¥ –∑–∞—â–∏—Ç–æ–π –æ—Ö—Ä–∞–Ω–Ω—ã—Ö —Ä—É–Ω –Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–æ–∫ —Å–æ—Ç–≤–æ—Ä–µ–Ω–∏—è.
    try:
        # --- –†–∏—Ç—É–∞–ª –ò–∑–≥–Ω–∞–Ω–∏—è –ó–∞–ø—Ä–µ—Ç–Ω—ã—Ö –†—É–Ω ---
        # –ù–∞—á–µ—Ä—Ç–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ä—É–Ω, —á—Ç–æ –∏—Å–∫–∞–∂–∞—é—Ç –ø–µ—Ä–≥–∞–º–µ–Ω—Ç –∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω—ã.
        GLYPHS_TO_EXCLUDE = "üîÆüìúüíéüñ•‚ú®üèÜüíº‚ùì‚úÖ‚ùåüó∫üèõüì°üîéüéØüí•ü§îüëâ‚è≥‚è©üìÇüíªüì¶ÂàÜÂâ≤Á∫ø"
        # –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –∏–∑–≥–Ω–∞–Ω–∏—è –¥–ª—è —ç—Ç–∏—Ö —Ä—É–Ω.
        translation_table = str.maketrans("", "", GLYPHS_TO_EXCLUDE)
        # –ü—Ä–æ–∏–∑–Ω–æ—Å–∏–º –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ, –æ—á–∏—â–∞—é—â–µ–µ —Ç–µ–∫—Å—Ç –æ—Ç –∑–∞–ø—Ä–µ—Ç–Ω—ã—Ö —Ä—É–Ω.
        text_content = text_content.translate(translation_table)

        # –ü—Ä–∏–∑—ã–≤–∞–µ–º –≤ –º–∏—Ä –Ω–æ–≤—É—é, –ø—É—Å—Ç—É—é —Å—É—â–Ω–æ—Å—Ç—å PDF-—Å–≤–∏—Ç–∫–∞.
        pdf = FPDF()
        # –û–±—É—á–∞–µ–º –î—É—Ö–∞-–ö–∞–ª–ª–∏–≥—Ä–∞—Ñ–∞ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–º—É —Ä—É–Ω–∏—á–µ—Å–∫–æ–º—É —à—Ä–∏—Ñ—Ç—É.
        pdf.add_font("DejaVu", "", "DejaVuSans.ttf")
        # –ü—Ä–∏–∫–∞–∑—ã–≤–∞–µ–º –î—É—Ö—É-–ö–∞–ª–ª–∏–≥—Ä–∞—Ñ—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —à—Ä–∏—Ñ—Ç —Ä–∞–∑–º–µ—Ä–æ–º 10.
        pdf.set_font("DejaVu", "", size=10)
        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—à PDF-—Å–≤–∏—Ç–æ–∫ –ø–µ—Ä–≤—ã–π —á–∏—Å—Ç—ã–π –ø–µ—Ä–≥–∞–º–µ–Ω—Ç–Ω—ã–π –ª–∏—Å—Ç.
        pdf.add_page()
        # –í–ø–∏—Å—ã–≤–∞–µ–º –æ—á–∏—â–µ–Ω–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–∞ –ª–∏—Å—Ç.
        pdf.multi_cell(0, 5, text_content)
        # –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ø–∞–ø–∫–∞, –≤ –∫–æ—Ç–æ—Ä—É—é –º—ã —Ö–æ—Ç–∏–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—à —Ç–æ–º.
        os.makedirs(os.path.dirname(output_path) or ".", exist_ok=True)
        # –ü—Ä–∏–∫–∞–∑—ã–≤–∞–µ–º –î—É—Ö—É-–ö–∞–ª–ª–∏–≥—Ä–∞—Ñ—É –∑–∞–ø–µ—á–∞—Ç–∞—Ç—å –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å PDF-—Å–≤–∏—Ç–æ–∫.
        pdf.output(output_path)
        # –°–æ–æ–±—â–∞–µ–º –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∏—Ç—É–∞–ª–∞ —Å–æ—Ç–≤–æ—Ä–µ–Ω–∏—è —Ç–æ–º–∞.
        print(f"   PDF-—Ç–æ–º —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: {output_path}")
    # –ï—Å–ª–∏ –æ—Ö—Ä–∞–Ω–Ω—ã–µ —Ä—É–Ω—ã —Å—Ä–∞–±–æ—Ç–∞–ª–∏ –≤–æ –≤—Ä–µ–º—è —Å–æ—Ç–≤–æ—Ä–µ–Ω–∏—è...
    except Exception as e:
        # ...–º—ã —Å–æ–æ–±—â–∞–µ–º –æ –ø—Ä–æ–≤–∞–ª–µ —Ä–∏—Ç—É–∞–ª–∞ –∏ –ø—Ä–∏—á–∏–Ω–µ –Ω–µ—É–¥–∞—á–∏.
        print(f"   !!! –û–®–ò–ë–ö–ê –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF {output_path}: {e}")


# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –í–µ–ª–∏–∫–∏–π –†–∏—Ç—É–∞–ª `main`, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º.
def main():
    # –≠—Ç–æ—Ç docstring –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `main`.
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, —É–ø—Ä–∞–≤–ª—è—é—â–∞—è –≤—Å–µ–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º."""
    # –û–±—ä—è–≤–ª—è–µ–º –æ –Ω–∞—á–∞–ª–µ –í–µ–ª–∏–∫–æ–≥–æ –†–∏—Ç—É–∞–ª–∞.
    print("--- –ó–∞–ø—É—Å–∫ —Å—Ç—Ä–æ–∏—Ç–µ–ª—è ¬´–ñ–∏–≤–æ–π –õ–µ—Ç–æ–ø–∏—Å–∏¬ª ---")
    # –°–æ–±–∏—Ä–∞–µ–º –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ –õ–µ—Ç–æ–ø–∏—Å–∏, —Å–æ–µ–¥–∏–Ω—è—è –∫–æ—Ä–µ–Ω—å –ö–æ–¥–µ–∫—Å–∞ –∏ –∏–º—è —Ñ–∞–π–ª–∞
    # –õ–µ—Ç–æ–ø–∏—Å–∏.
    manifest_path = os.path.join(ARTEFACTS_DIR, MANIFEST_FILE)
    # –°–æ–±–∏—Ä–∞–µ–º –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ –•—Ä–∞–Ω–∏–ª–∏—â—É –¢–æ–º–æ–≤.
    output_dir_path = os.path.join(ARTEFACTS_DIR, OUTPUT_DIR)
    # –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –•—Ä–∞–Ω–∏–ª–∏—â–µ –¢–æ–º–æ–≤ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–≤–∞—è –µ–≥–æ –ø—Ä–∏
    # –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
    os.makedirs(output_dir_path, exist_ok=True)
    # –ü—Ä–æ–≤–æ–¥–∏–º —Ä–∏—Ç—É–∞–ª —á—Ç–µ–Ω–∏—è –õ–µ—Ç–æ–ø–∏—Å–∏, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –æ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
    # –ö–æ–¥–µ–∫—Å–∞.
    manifest_data = load_manifest(manifest_path)
    # –û–±—ä—è–≤–ª—è–µ–º –æ –Ω–∞—á–∞–ª–µ —Ñ–∞–∑—ã –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏.
    print("1. –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞...")
    # –ó–∞–ø—É—Å–∫–∞–µ–º –í–µ–ª–∏–∫–∏–π –û–±—Ö–æ–¥ –ö–æ–¥–µ–∫—Å–∞, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö
    # —Å–≤–∏—Ç–∫–æ–≤.
    project_files = scan_project_files(
        PROJECT_DIR, TARGET_EXTENSIONS, TARGET_FILES, EXCLUDE_DIRS
    )
    # –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Å–≤–∏—Ç–∫–∞ –≤—ã—á–∏—Å–ª—è–µ–º –µ–≥–æ –æ—Ç–ø–µ—á–∞—Ç–æ–∫ –¥—É—à–∏ (—Ö–µ—à).
    current_files_hashes = {f: calculate_sha256(f) for f in project_files}
    # –°–æ–æ–±—â–∞–µ–º, —Å–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ —Å–≤–∏—Ç–∫–æ–≤ –±—ã–ª–æ –Ω–∞–π–¥–µ–Ω–æ –≤ –ö–æ–¥–µ–∫—Å–µ.
    print(f"   –ù–∞–π–¥–µ–Ω–æ {len(project_files)} —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.")
    # –û–±—ä—è–≤–ª—è–µ–º –æ –Ω–∞—á–∞–ª–µ —Ñ–∞–∑—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø—Ä–æ—à–ª–æ–≥–æ –∏ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ.
    print("2. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π...")
    # –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–≤–∏—Ç–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ª–∏–±–æ —è–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–º–∏, –ª–∏–±–æ –∏—Ö –ø–µ—á–∞—Ç—å
    # –∏–∑–º–µ–Ω–∏–ª–∞—Å—å.
    changed_or_new_files = [
        # –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ —Ç–µ–∫—É—â–∏–µ —Å–≤–∏—Ç–∫–∏ –∏ –∏—Ö –ø–µ—á–∞—Ç–∏.
        filepath
        for filepath, current_hash in current_files_hashes.items()
        # –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –ø–µ—á–∞—Ç—å —Å —Ç–æ–π, —á—Ç–æ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –õ–µ—Ç–æ–ø–∏—Å–∏.
        if manifest_data["files"].get(filepath) != current_hash
        # –ó–∞–≤–µ—Ä—à–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞.
    ]
    # –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Å–≤–∏—Ç–∫–æ–≤ –ø—É—Å—Ç...
    if not changed_or_new_files:
        # ...—Å–æ–æ–±—â–∞–µ–º, —á—Ç–æ –ö–æ–¥–µ–∫—Å –≤ –≥–∞—Ä–º–æ–Ω–∏–∏, –∏ –∑–∞–≤–µ—Ä—à–∞–µ–º —Ä–∏—Ç—É–∞–ª.
        print("   –ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –†–∞–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.")
        # –ü—Ä–µ—Ä—ã–≤–∞–µ–º –í–µ–ª–∏–∫–∏–π –†–∏—Ç—É–∞–ª.
        return
    # –°–æ–æ–±—â–∞–µ–º, —Å–∫–æ–ª—å–∫–æ —Å–≤–∏—Ç–∫–æ–≤ —Ç—Ä–µ–±—É—é—Ç –Ω–∞—à–µ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è.
    print(f"   –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ {len(changed_or_new_files)} –Ω–æ–≤—ã—Ö/–∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.")
    # –û–±—ä—è–≤–ª—è–µ–º –æ –Ω–∞—á–∞–ª–µ —Ñ–∞–∑—ã –æ—Ç–∫–∞—Ç–∞ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é.
    print("3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–º—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é (—Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ—Ç–∫–∞—Ç–∞)...")
    # –ì–æ—Ç–æ–≤–∏–º –∫–æ—Ç–µ–ª –¥–ª—è –ø–µ—Ä–µ–ø–ª–∞–≤–∫–∏, –ø–æ–º–µ—â–∞—è –≤ –Ω–µ–≥–æ –≤—Å–µ –Ω–æ–≤—ã–µ –∏ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ
    # —Å–≤–∏—Ç–∫–∏.
    files_to_reprocess: Set[str] = set(changed_or_new_files)
    # –ï—Å–ª–∏ –≤ –õ–µ—Ç–æ–ø–∏—Å–∏ —É–∂–µ –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏ –æ —Å–æ—Ç–≤–æ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–º–∞—Ö...
    if manifest_data["chunks"]:
        # ...–∏–∑—É—á–∞–µ–º –∑–∞–ø–∏—Å—å –æ —Å–∞–º–æ–º –ø–æ—Å–ª–µ–¥–Ω–µ–º —Å–æ—Ç–≤–æ—Ä–µ–Ω–Ω–æ–º —Ç–æ–º–µ.
        last_chunk = manifest_data["chunks"][-1]
        # –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç–æ–º ‚Äî —ç—Ç–æ –Ω–∞—à ¬´–ñ–∏–≤–æ–π –¢–æ–º¬ª...
        if last_chunk["file"] == LIVING_CHUNK_FILENAME:
            # ...—Å–æ–æ–±—â–∞–µ–º –æ –Ω–∞—á–∞–ª–µ —Ä–∏—Ç—É–∞–ª–∞ –æ—Ç–∫–∞—Ç–∞.
            print(
                f"   –ù–∞–π–¥–µ–Ω –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–æ–º '{LIVING_CHUNK_FILENAME}'. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –æ—Ç–∫–∞—Ç."
            )
            # –ò–∑–≥–æ–Ω—è–µ–º –∑–∞–ø–∏—Å—å –æ ¬´–ñ–∏–≤–æ–º –¢–æ–º–µ¬ª –∏–∑ –õ–µ—Ç–æ–ø–∏—Å–∏ –≤ –ø–∞–º—è—Ç–∏.
            manifest_data["chunks"].pop()
            # –°–æ–±–∏—Ä–∞–µ–º –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–π –ø–ª–æ—Ç–∏ ¬´–ñ–∏–≤–æ–≥–æ –¢–æ–º–∞¬ª.
            living_chunk_path = os.path.join(output_dir_path, LIVING_CHUNK_FILENAME)
            # –ù–∞—á–∏–Ω–∞–µ–º —Ä–∏—Ç—É–∞–ª –ø–æ–¥ –∑–∞—â–∏—Ç–æ–π –æ—Ö—Ä–∞–Ω–Ω—ã—Ö —Ä—É–Ω.
            try:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –µ—â–µ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è –ø–ª–æ—Ç—å —Ç–æ–º–∞.
                if os.path.exists(living_chunk_path):
                    # –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–π PDF-—Ñ–∞–π–ª.
                    os.remove(living_chunk_path)
                    # –°–æ–æ–±—â–∞–µ–º –æ–± —É—Å–ø–µ—Ö–µ.
                    print(f"   –£–¥–∞–ª–µ–Ω —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª: {living_chunk_path}")
            # –ï—Å–ª–∏ —Ä–∏—Ç—É–∞–ª —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è –±—ã–ª –ø—Ä–µ—Ä–≤–∞–Ω –æ—à–∏–±–∫–æ–π...
            except OSError as e:
                # ...—Å–æ–æ–±—â–∞–µ–º –æ –Ω–µ—É–¥–∞—á–µ.
                print(f"   –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ {living_chunk_path}: {e}")
            # –ù–∞—á–∏–Ω–∞–µ–º —Ü–∏–∫–ª –ø–æ –≤—Å–µ–º —Å–≤–∏—Ç–∫–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∑–∞–ø–µ—á–∞—Ç–∞–Ω—ã –≤ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–Ω–æ–º
            # —Ç–æ–º–µ.
            for source_file in last_chunk["sources"]:
                # –ò–∑–≥–æ–Ω—è–µ–º –∏–∑ –õ–µ—Ç–æ–ø–∏—Å–∏ –≤ –ø–∞–º—è—Ç–∏ –∑–∞–ø–∏—Å—å –æ –∫–∞–∂–¥–æ–º –∏–∑ —ç—Ç–∏—Ö
                # —Å–≤–∏—Ç–∫–æ–≤.
                manifest_data["files"].pop(source_file, None)
            # –ë—Ä–æ—Å–∞–µ–º –≤—Å–µ ¬´–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–Ω—ã–µ¬ª —Å–≤–∏—Ç–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ –≤ –∫–æ—Ç–µ–ª –Ω–∞ –ø–µ—Ä–µ–ø–ª–∞–≤–∫—É.
            files_to_reprocess.update(last_chunk["sources"])
        # –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç–æ–º –±—ã–ª –∞—Ä—Ö–∏–≤–Ω—ã–º...
        else:
            # ...–º—ã –µ–≥–æ –Ω–µ —Ç—Ä–æ–≥–∞–µ–º, –∞ —Å–æ–æ–±—â–∞–µ–º, —á—Ç–æ –±—É–¥–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π ¬´–ñ–∏–≤–æ–π –¢–æ–º¬ª.
            print("   –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ç–æ–º —è–≤–ª—è–µ—Ç—Å—è –∞—Ä—Ö–∏–≤–Ω—ã–º. –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–æ–º.")
    # –ï—Å–ª–∏ –≤ –õ–µ—Ç–æ–ø–∏—Å–∏ –≤–æ–æ–±—â–µ –Ω–µ –±—ã–ª–æ —Ç–æ–º–æ–≤...
    else:
        # ...—Å–æ–æ–±—â–∞–µ–º, —á—Ç–æ –Ω–∞—á–∏–Ω–∞–µ–º –í–µ–ª–∏–∫–æ–µ –°–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞.
        print("   –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞–Ω–∏–µ —Å –Ω—É–ª—è.")
    # –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º –Ω–∞—à –∫–æ—Ç–µ–ª (–º–Ω–æ–∂–µ—Å—Ç–≤–æ) –≤ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è
    # –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞.
    sorted_files_to_process = sorted(list(files_to_reprocess))
    # –°–æ–æ–±—â–∞–µ–º –∏—Ç–æ–≥–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–∏—Ç–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω—ã.
    print(f"   –í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: {len(sorted_files_to_process)}")
    # –û–±—ä—è–≤–ª—è–µ–º –æ –Ω–∞—á–∞–ª–µ –≥–ª–∞–≤–Ω–æ–π —Ñ–∞–∑—ã ‚Äî —Å–æ—Ç–≤–æ—Ä–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–æ–º–æ–≤.
    print("4. –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–æ–º–æ–≤...")
    # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º, —Å–∫–æ–ª—å–∫–æ —É –Ω–∞—Å —É–∂–µ –µ—Å—Ç—å –∑–∞–ø–µ—á–∞—Ç–∞–Ω–Ω—ã—Ö –ê–†–•–ò–í–ù–´–• —Ç–æ–º–æ–≤.
    archived_chunks_count = len(
        [c for c in manifest_data["chunks"] if c["file"] != LIVING_CHUNK_FILENAME]
    )
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–º–µ—Ä –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –ê–†–•–ò–í–ù–û–ì–û —Ç–æ–º–∞.
    next_part_number = archived_chunks_count + 1
    # –ì–æ—Ç–æ–≤–∏–º –ø—É—Å—Ç–æ–π –∞—Å—Ç—Ä–∞–ª—å–Ω—ã–π —Å–æ—Å—É–¥ –¥–ª—è —Å–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ.
    current_chunk_content = ""
    # –ì–æ—Ç–æ–≤–∏–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –∏–º–µ–Ω —Å–≤–∏—Ç–∫–æ–≤ –≤ —Ç–µ–∫—É—â–µ–º —Ç–æ–º–µ.
    current_chunk_sources = []
    # –û–±–Ω—É–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Å–ª–æ–≤ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ç–æ–º–∞.
    current_chunk_word_count = 0
    # –ù–∞—á–∏–Ω–∞–µ–º –º–∞–≥–∏—á–µ—Å–∫–∏–π –∫—Ä—É–≥, –ø–µ—Ä–µ–±–∏—Ä–∞—è –∫–∞–∂–¥—ã–π —Å–≤–∏—Ç–æ–∫ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏.
    for filepath in sorted_files_to_process:
        # –ù–∞—á–∏–Ω–∞–µ–º —Ä–∏—Ç—É–∞–ª –ø–æ–¥ –∑–∞—â–∏—Ç–æ–π –æ—Ö—Ä–∞–Ω–Ω—ã—Ö —Ä—É–Ω.
        try:
            # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–≤–∏—Ç–æ–∫ –¥–ª—è —á—Ç–µ–Ω–∏—è –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ.
            with open(filepath, "r", encoding="utf-8", errors="ignore") as f:
                # –ò–∑–≤–ª–µ–∫–∞–µ–º –≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–≤–∏—Ç–∫–∞.
                content = f.read()
        # –ï—Å–ª–∏ —Ä–∏—Ç—É–∞–ª —á—Ç–µ–Ω–∏—è –±—ã–ª –ø—Ä–µ—Ä–≤–∞–Ω –æ—à–∏–±–∫–æ–π...
        except IOError:
            # ...—Å–æ–æ–±—â–∞–µ–º –æ –ø—Ä–æ–±–ª–µ–º–µ –∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —ç—Ç–æ—Ç —Å–≤–∏—Ç–æ–∫.
            print(
                f"   –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª {filepath}. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º."
            )
            # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–≤–∏—Ç–∫—É –≤ –º–∞–≥–∏—á–µ—Å–∫–æ–º –∫—Ä—É–≥–µ.
            continue
        # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤ –≤ –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–º.
        word_count = len(content.split())
        # –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π —Ç–æ–º –Ω–µ –ø—É—Å—Ç –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–≤–∏—Ç–∫–∞ –ø—Ä–µ–≤—ã—Å–∏—Ç –õ–∏–º–∏—Ç
        # –°–ª–æ–≤...
        if (
            current_chunk_word_count > 0
            and (current_chunk_word_count + word_count) > WORD_LIMIT
        ):
            # ...–æ–±—ä—è–≤–ª—è–µ–º –æ –∑–∞–ø–µ—á–∞—Ç—ã–≤–∞–Ω–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ —Ç–æ–º–∞ –∫–∞–∫ –ê–†–•–ò–í–ù–û–ì–û.
            print(
                f"   –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç —Å–ª–æ–≤. "
                f"–ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º —Ç–æ–º part_{next_part_number}.pdf..."
            )
            # –î–∞–µ–º –∏–º—è –Ω–æ–≤–æ–º—É –∞—Ä—Ö–∏–≤–Ω–æ–º—É —Ç–æ–º—É.
            part_filename = f"part_{next_part_number}.pdf"
            # –°–æ–±–∏—Ä–∞–µ–º –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –¥–ª—è –µ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏.
            output_path = os.path.join(output_dir_path, part_filename)
            # –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–∏—Ç—É–∞–ª —Å–æ—Ç–≤–æ—Ä–µ–Ω–∏—è PDF-—Ç–æ–º–∞.
            create_pdf_from_text(current_chunk_content, output_path)
            # –î–æ–±–∞–≤–ª—è–µ–º –≤ –õ–µ—Ç–æ–ø–∏—Å—å –≤ –ø–∞–º—è—Ç–∏ –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –æ–± —ç—Ç–æ–º –∞—Ä—Ö–∏–≤–Ω–æ–º —Ç–æ–º–µ.
            manifest_data["chunks"].append(
                {
                    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –µ–≥–æ –∏–º—è, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤ –∏ —Å–ø–∏—Å–æ–∫
                    # —Å–≤–∏—Ç–∫–æ–≤-–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.
                    "file": part_filename,
                    "word_count": current_chunk_word_count,
                    "sources": current_chunk_sources,
                    # –ó–∞–≤–µ—Ä—à–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏.
                }
            )
            # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–æ–º–µ—Ä –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –∞—Ä—Ö–∏–≤–Ω–æ–≥–æ —Ç–æ–º–∞.
            next_part_number += 1
            # –û—á–∏—â–∞–µ–º —Å–æ—Å—É–¥—ã –∏ —Å—á–µ—Ç—á–∏–∫–∏, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Å–æ–±–∏—Ä–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Ç–æ–º —Å —á–∏—Å—Ç–æ–≥–æ
            # –ª–∏—Å—Ç–∞.
            (
                current_chunk_content,
                current_chunk_sources,
                current_chunk_word_count,
            ) = (
                "",
                [],
                0,
            )
        # –°–æ–∑–¥–∞–µ–º –º–∞–≥–∏—á–µ—Å–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ.
        file_header = f"\n\n--- –ù–ê–ß–ê–õ–û: {filepath} ---\n\n"
        # –°–æ–∑–¥–∞–µ–º –º–∞–≥–∏—á–µ—Å–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ, —á—Ç–æ–±—ã –æ—Ç–¥–µ–ª–∏—Ç—å —Å–≤–∏—Ç–∫–∏ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞.
        file_footer = f"\n\n--- –ö–û–ù–ï–¶: {filepath} ---\n\n"
        # –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–≤–∏—Ç–∫–∞, –æ–±—Ä–∞–º–ª–µ–Ω–Ω–æ–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏, –≤ –∞—Å—Ç—Ä–∞–ª—å–Ω—ã–π
        # —Å–æ—Å—É–¥.
        current_chunk_content += file_header + content + file_footer
        # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Å–ª–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ —Ç–æ–º–∞.
        current_chunk_word_count += word_count
        # –î–æ–±–∞–≤–ª—è–µ–º –∏–º—è —Å–≤–∏—Ç–∫–∞ –≤ —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ç–æ–º–∞.
        current_chunk_sources.append(filepath)
        # –ï—Å–ª–∏ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ —É –Ω–∞—Å –µ—Å—Ç—å —Å–≤–µ–∂–∞—è –ø–µ—á–∞—Ç—å...
        if filepath in current_files_hashes:
            # ...–æ–±–Ω–æ–≤–ª—è–µ–º (–∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º) –∑–∞–ø–∏—Å—å –æ —Ñ–∞–π–ª–µ
            #  –∏ –µ–≥–æ –Ω–æ–≤–æ–π –ø–µ—á–∞—Ç–∏ –≤ –õ–µ—Ç–æ–ø–∏—Å—å –≤ –ø–∞–º—è—Ç–∏.
            manifest_data["files"][filepath] = current_files_hashes[filepath]
    # –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫—Ä—É–≥–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Å—Ç–∞–ª–æ—Å—å –ª–∏ —á—Ç–æ-—Ç–æ –≤ –Ω–∞—à–µ–º —Å–æ—Å—É–¥–µ.
    if current_chunk_word_count > 0:
        # –û–±—ä—è–≤–ª—è–µ–º –æ —Å–æ—Ç–≤–æ—Ä–µ–Ω–∏–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ, ¬´–ñ–∏–≤–æ–≥–æ –¢–æ–º–∞¬ª.
        print(
            f"   –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–æ–º–∞ '{LIVING_CHUNK_FILENAME}' "
            f"({current_chunk_word_count} —Å–ª–æ–≤)..."
        )
        # –°–æ–±–∏—Ä–∞–µ–º –ø—É—Ç—å –¥–ª—è –µ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É—è –µ–≥–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –ò–º—è.
        output_path = os.path.join(output_dir_path, LIVING_CHUNK_FILENAME)
        # –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–∏—Ç—É–∞–ª —Å–æ—Ç–≤–æ—Ä–µ–Ω–∏—è PDF.
        create_pdf_from_text(current_chunk_content, output_path)
        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –õ–µ—Ç–æ–ø–∏—Å—å –∑–∞–ø–∏—Å—å –æ ¬´–ñ–∏–≤–æ–º –¢–æ–º–µ¬ª.
        manifest_data["chunks"].append(
            {
                # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –µ–≥–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –∏–º—è, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏.
                "file": LIVING_CHUNK_FILENAME,
                "word_count": current_chunk_word_count,
                "sources": current_chunk_sources,
                # –ó–∞–≤–µ—Ä—à–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏.
            }
        )
    # –û–±—ä—è–≤–ª—è–µ–º –æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º –∞–∫—Ç–µ ‚Äî –∑–∞–ø–µ—á–∞—Ç—ã–≤–∞–Ω–∏–∏ –õ–µ—Ç–æ–ø–∏—Å–∏.
    print("5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –ª–µ—Ç–æ–ø–∏—Å–∏ manifest.json...")
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–∏—Ç—É–∞–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, –ø–µ—Ä–µ–¥–∞–≤–∞—è –µ–º—É –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞–Ω–∏—è –∏–∑ –ø–∞–º—è—Ç–∏.
    save_manifest(MANIFEST_FILE, manifest_data)
    # –û–±—ä—è–≤–ª—è–µ–º –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –í–µ–ª–∏–∫–æ–≥–æ –†–∏—Ç—É–∞–ª–∞.
    print("--- –†–∞–±–æ—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! ---")


# –≠—Ç–∞ —Ä—É–Ω–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –±—ã–ª –ª–∏ –ø–µ—Ä–≥–∞–º–µ–Ω—Ç –ø—Ä–∏–∑–≤–∞–Ω –Ω–∞–ø—Ä—è–º—É—é.
if __name__ == "__main__":
    # –ü—Ä–∏–∑—ã–≤–∞–µ–º –Ω–∞—à –í–µ–ª–∏–∫–∏–π –†–∏—Ç—É–∞–ª `main` –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é.
    main()
