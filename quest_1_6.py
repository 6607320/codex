# === quest_1_6.py ===
# Квест: 1.6 - Призыв Духа-Сказителя
# Цель: Использовать AI не для анализа, а для синтеза (генерации) нового текста.
# Этот скрипт также демонстрирует важнейший урок: модель нужно использовать
# с теми данными (в данном случае, языком), на которых она обучалась.

# --- Акт 1: Подготовка Гримуаров ---

# Снова используем наш универсальный "амулет" pipeline.
from transformers import pipeline
# PyTorch нужен, чтобы убедиться, что магия будет исполняться на Кристалле Маны.
import torch

# --- Акт 2: Призыв "Духа-Сказителя" ---

# Сообщаем о начале ритуала.
print("Призываю Духа-Сказителя...")

# Создаем наш "амулет" (объект pipeline), но уже для другой задачи.
# 1. 'text-generation' - Название задачи. Мы хотим "генерировать текст".
# 2. model='distilgpt2' - Имя "духа". distilgpt2 - это "младший брат" великого GPT-2,
#    он маленький, быстрый и идеально подходит для нашего Кристалла Маны.
# 3. device=0 - Это руна-приказ: "Исполняй это заклинание на Кристалле Маны
#    под номером 0 (основной GPU)". Это сильно ускоряет генерацию.
storyteller = pipeline('text-generation', model='distilgpt2', device=0)

# --- Акт 3: Ритуал Творения (с ошибкой) ---

# Создаем "затравку" (prompt) - начало истории, которое мы дадим Духу.
# ВАЖНО: Мы намеренно пишем его на РУССКОМ, чтобы увидеть, как "англоговорящий"
# дух отреагирует на незнакомый ему язык.
prompt = "В магической мастерской техномант склонился над светящимся терминалом..."
# Сообщаем, с чего начнется история.
print(f"Начало истории: {prompt}")

# Запускаем сам процесс генерации.
# Мы передаем в "амулет" storyteller нашу затравку и несколько "управляющих рун":
generated_story = storyteller(
    prompt,
    # max_length - "Ограничитель". Вся история (затравка + продолжение)
    # не должна быть длиннее 60 "рун"-токенов.
    max_length=60, 
    # num_return_sequences - "Умеренность". Просим сгенерировать только ОДИН
    # вариант продолжения истории.
    num_return_sequences=1,
)

# --- Акт 4: Демонстрация Результата ---

# Выводим заголовок для сгенерированного текста.
print("\n...Дух-Сказитель продолжает:")
# Результат ('generated_story') - это список. Мы берем первый (и единственный) элемент [0].
# Внутри него результат лежит в словаре под ключом 'generated_text'. Мы извлекаем его.
# Ожидаемый результат - бессмысленный набор символов, так как модель не знает русского.
print(generated_story[0]['generated_text'])