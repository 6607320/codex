# --- Этап 1: "Кузница" (The Forge / Build Stage) ---
# Мы начинаем с полного, "толстого" образа Python. Он содержит все инструменты для компиляции.
# Мы даем этому этапу магическое имя 'builder', чтобы потом ссылаться на него.
FROM python:3.10 AS builder

# Устанавливаем рабочую директорию внутри "Кузницы".
WORKDIR /app

# Копируем наш "рецепт" с гримуарами.
COPY requirements.txt .

# Произносим главное заклинание ковки: "Призови все гримуары".
# На этом этапе pip может скачивать и компилировать тяжелые пакеты, используя инструменты из "толстого" образа.
RUN pip install --no-cache-dir -r requirements.txt


# --- Этап 2: "Тронный Зал" (The Showroom / Final Stage) ---
# Теперь мы начинаем ЗАНОВО, с чистого листа.
# Мы берем за основу легчайший, "slim" образ. В нем нет ничего лишнего.
FROM python:3.10-slim

# Устанавливаем рабочую директорию в "Тронном Зале".
WORKDIR /app

# !!! ГЛАВНАЯ МАГИЯ: ОТКРЫТИЕ ПОРТАЛА !!!
# Мы приказываем скопировать файлы не с нашего диска, а ИЗ другого этапа ('--from=builder').
# Мы телепортируем папку site-packages, где лежат уже установленные и готовые гримуары, из "Кузницы" в "Тронный Зал".
COPY --from=builder /usr/local/lib/python3.10/site-packages /usr/local/lib/python3.10/site-packages

# Теперь мы копируем наш собственный, легкий код приложения.
COPY . .

# Заклинание, которое будет исполнено при пробуждении финального, чистого контейнера.
CMD ["uvicorn", "quest_25_2:app", "--host", "0.0.0.0", "--port", "8000"]