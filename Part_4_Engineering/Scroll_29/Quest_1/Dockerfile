# Этот комментарий — наставление от Мастера, объясняющее выбор "первозданной глины" для нашего Голема.
# Используем стандартный, полный образ Python. Он больше, но надежнее.
# Мы произносим главное заклинание `FROM`, которое говорит: "Начни творение с этого готового 'слепка мира'".
# Мы берем официальный, полный "слепок мира" с `python:3.10` в качестве нашей "первозданной глины".
FROM python:3.10

# Это наставление описывает следующий шаг: создание "мастерской".
# Устанавливаем рабочую директорию
# Мы произносим заклинание `WORKDIR`, которое создает внутри Голема "мастерскую" по имени `/app` и "входит" в нее.
WORKDIR /app

# Это наставление описывает ритуал копирования.
# Копируем свиток зависимостей
# Мы произносим заклинание `COPY`, телепортируя "свиток с перечнем гримуаров" (`requirements.lock`) в "мастерскую".
COPY requirements.lock .

# Это наставление объясняет, как мы будем призывать гримуары.
# Устанавливаем зависимости НАПРЯМУЮ в финальный образ
# Мы проводим ритуал (`RUN`), приказывая духу `pip` прочесть "свиток" и призвать все необходимые гримуары.
RUN pip install --no-cache-dir -r requirements.lock

# Это наставление описывает, как мы поместим "сердце" в нашего Голема.
# Копируем наш код
# Мы произносим еще одно заклинание `COPY`, телепортируя "сердце" нашего Голема (`main.py`) в "мастерскую".
COPY main.py .

# --- Толкование: Скрипт Пробуждения (start.sh) ---
# Мы используем отдельный скрипт `start.sh`, а не просто `CMD ["uvicorn"...]`,
# чтобы гарантированно исполнить 'Главное Заклинание Жизни' в чистой среде.
# Этот метод защищает нас от 'проклятия кодировок' (`exec format error`) и
# позволяет гибко использовать 'секретную руну окружения' `${PORT}`,
# которую диктует Облачная Цитадель (`Cloud Run`).

# Мы телепортируем (`COPY`) пергамент со "Заклинанием Пробуждения" в нашу мастерскую.
COPY start.sh .
# Мы накладываем "Руну-Печать Разрешения" (`chmod +x`), даруя пергаменту "право на жизнь".
RUN chmod +x ./start.sh
# Мы накладываем "Главное Заклинание Жизни" (`CMD`), приказывая Голему при своем пробуждении исполнить `start.sh`.
CMD ["./start.sh"]
