# Используем стандартный, полный образ Python. Он больше, но надежнее.
FROM python:3.10

# Устанавливаем рабочую директорию
WORKDIR /app

# Копируем свиток зависимостей
COPY libraries.list .

# Устанавливаем зависимости НАПРЯМУЮ в финальный образ
RUN pip install --no-cache-dir -r libraries.list

# Копируем ВСЕ пергаменты из нашей мастерской
COPY . .

# --- Толкование: Скрипт Пробуждения (start.sh) ---
# Мы используем отдельный скрипт `start.sh`, чтобы гарантированно исполнить 'Главное
# Заклинание Жизни' в чистой ASCII-среде. Этот метод защищает нас от 'проклятия
# кодировок' (`exec format error`). Внутри него начертано заклинание `uvicorn`,
# которое приказывает: "Пробуди артефакт `app` из пергамента `main`, слушай мир
# с помощью 'Руны Всеслышания' (`--host 0.0.0.0`) и открой портал на номере,
# который укажет Облачная Цитадель (`--port ${PORT}`)".

# Мы накладываем "Руну-Печать Разрешения" (`chmod +x`), даруя пергаменту `start.sh` "право на жизнь".
RUN chmod +x ./start.sh

# Мы накладываем "Главное Заклинание Жизни" (`CMD`), приказывая Голему при своем пробуждении исполнить `start.sh`.
CMD ["./start.sh"]
