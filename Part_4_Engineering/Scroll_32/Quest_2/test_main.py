"""Квест 32.2: "Свиток-Экзаменатор".

Этот пергамент — "экзаменационный билет" для нашего финального артефакта.
Его единственная цель (МАКРО-контекст) — быть обнаруженным и исполненным
"Великим Экзаменатором" (`pytest`) в рамках CI/CD пайплайна.

Он содержит простые "заклинания дыма" (smoke tests), которые проверяют
базовую работоспособность нашего "Амулета", доказывая, что он в принципе
жив и способен отвечать на призывы. Это первый и самый важный рубеж
автоматизированного контроля качества.
"""

# Мы призываем из гримуара FastAPI специальный инструмент для испытаний,
# "Магического Посланца", который может общаться с нашим порталом.
from fastapi.testclient import TestClient
# Мы призываем "душу" нашего артефакта, саму сущность 'app' из
# главного пергамента, чтобы Посланец знал, с кем говорить.
from main import app

# Мы сотворяем самого "Магического Посланца", привязывая его к нашему 'app'.
client = TestClient(app)


# Мы объявляем о начале первого испытания. Имя ритуала должно начинаться
# с 'test_', чтобы Великий Экзаменатор pytest его нашел.
def test_validate_endpoint_returns_ok():
    # Посланец отправляет пустое послание методом POST к вратам '/validate'.
    response = client.post("/validate")
    # Главный верди-кт: мы утверждаем, что код ответа, который вернул портал,
    # должен быть в точности равен 200 (знак успеха).
    assert response.status_code == 200


# Мы объявляем о начале второго испытания.
def test_analyze_endpoint_returns_ok():
    # Посланец отправляет корректное "магическое послание" к вратам '/analyze'.
    response = client.post("/analyze", json={"text": "This is a test."})
    # Мы утверждаем, что ответ также должен быть успешным (код 200).
    assert response.status_code == 200
